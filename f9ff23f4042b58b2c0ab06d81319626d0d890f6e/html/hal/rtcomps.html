<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 9.0.0rc2" />
<title>HAL Component Descriptions</title>
<link rel="stylesheet" href="..//asciidoc.css" type="text/css" />


<link rel="stylesheet" href="..//linuxcnc.css" type="text/css" />
<script type="text/javascript" src="..//asciidoc.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
<h1>HAL Component Descriptions</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph" id="cha:realtime-components"><p>This chapter provides details on core functionalities of LinuxCNC that demand exact timing for</p></div>
<div class="ulist"><ul>
<li>
<p>
the generation of signals that is intepreted by hardware (like motors) or
</p>
</li>
<li>
<p>
for the interpretation of signals sent by the hardware (like encoders).
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="sec:stepgen">1. StepGen</h2>
<div class="sectionbody">
<div class="paragraph"><p>This component provides software based generation of step pulses in
response to position or velocity commands. In position mode, it has a
built in pre-tuned position loop, so PID tuning is not required. In
velocity mode, it drives a motor at the commanded speed, while obeying
velocity and acceleration limits. It is a realtime component only, and
depending on CPU speed, etc, is capable of maximum step rates of 10&#8239;kHz
to perhaps 50&#8239;kHz. The step pulse generator block diagram shows three block
diagrams, each is a single step pulse generator. The first diagram is for
step type <em>0</em>, (step and direction). The second is for step type <em>1</em>
(up/down, or pseudo-PWM), and the third is for step types 2 through 14
(various stepping patterns). The first two diagrams show position mode
control, and the third one shows velocity mode. Control mode and step type
are set independently, and any combination can be selected.</p></div>
<div class="imageblock" id="fig:stepgen-block-diagram" style="text-align:center;">
<div class="content">
<figure>
<img src="images/stepgen-block-diag.png" alt="images/stepgen-block-diag.png"/>
<figcaption class="title"> Figure 1. Step Pulse Generator Block Diagram position mode</figcaption>
</figure>
</div>
</div>
<div class="listingblock">
<div class="title">Loading <code>stepgen</code> component</div>
<div class="content">
<pre><code>halcmd: loadrt stepgen step_type=&lt;type-array&gt; [ctrl_type=&lt;ctrl_array&gt;]</code></pre>
</div></div>
<div class="dlist"><dl>
<dt class="hdlist1">
&lt;type-array&gt;
</dt>
<dd>
<p>
is a series of comma separated decimal integers.
  Each number causes a single step pulse generator to be loaded, the value of the number determines the stepping type.
</p>
</dd>
<dt class="hdlist1">
&lt;ctrl_array&gt;
</dt>
<dd>
<p>
is a comma separated series of <em>p</em> or <em>v</em> characters, to specify position or velocity mode.
</p>
</dd>
<dt class="hdlist1">
ctrl_type
</dt>
<dd>
<p>
is optional, if omitted, all of the step generators will be position mode.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>halcmd: loadrt stepgen step_type=0,0,2 ctrl_type=p,p,v</code></pre>
</div></div>
<div class="paragraph"><p>Will install three step generators.
The first two use step type <em>0</em> (step and direction) and run in position mode.
The last one uses step type <em>2</em> (quadrature) and runs in velocity mode.
The default value for <em>&lt;config-array&gt;</em> is <em>0,0,0</em> which will install three type <em>0</em> (step/dir) generators.
The maximum number of step generators is 8 (as defined by MAX_CHAN in stepgen.c).
Each generator is independent, but all are updated by the same function(s) at the same time.
In the following descriptions, <em>&lt;chan&gt;</em> is the number of a specific generator. The first generator is number 0.</p></div>
<div class="listingblock">
<div class="title">Unloading <code>stepgen</code> component</div>
<div class="content">
<pre><code>halcmd: unloadrt stepgen</code></pre>
</div></div>
<div class="sect2">
<h3 id="sub:stepgen-pins">1.1. Pins</h3>
<div class="paragraph"><p>On the step type and control type selected.</p></div>
<div class="ulist"><ul>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.position-cmd` - Desired motor position, in position units (position mode only).
</p>
</li>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.velocity-cmd` - Desired motor velocity, in position units per second (velocity mode only).
</p>
</li>
<li>
<p>
s32) <code>stepgen.`__&lt;chan&gt;__</code>.counts` - Feedback position in counts, updated by <em>capture_position()</em>.
</p>
</li>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.position-fb` - Feedback position in position units, updated by <em>capture_position()</em>.
</p>
</li>
<li>
<p>
(bit) <code>stepgen.`__&lt;chan&gt;__</code>.enable` - Enables output steps - when false, no steps are generated.
</p>
</li>
<li>
<p>
(bit) <code>stepgen.`__&lt;chan&gt;__</code>.step` - Step pulse output (step type 0 only).
</p>
</li>
<li>
<p>
(bit) <code>stepgen.`__&lt;chan&gt;__</code>.dir` - Direction output (step type 0 only).
</p>
</li>
<li>
<p>
(bit) <code>stepgen.`__&lt;chan&gt;__</code>.up` - UP pseudo-PWM output (step type 1 only).
</p>
</li>
<li>
<p>
(bit) <code>stepgen.`__&lt;chan&gt;__</code>.down` - DOWN pseudo-PWM output (step type 1 only).
</p>
</li>
<li>
<p>
(bit) <code>stepgen.`__&lt;chan&gt;__</code>.phase-A` - Phase A output (step types 2-14 only).
</p>
</li>
<li>
<p>
(bit) <code>stepgen.`__&lt;chan&gt;__</code>.phase-B` - Phase B output (step types 2-14 only).
</p>
</li>
<li>
<p>
(bit) <code>stepgen.`__&lt;chan&gt;__</code>.phase-C` - Phase C output (step types 3-14 only).
</p>
</li>
<li>
<p>
(bit) <code>stepgen.`__&lt;chan&gt;__</code>.phase-D` - Phase D output (step types 5-14 only).
</p>
</li>
<li>
<p>
(bit) <code>stepgen.`__&lt;chan&gt;__</code>.phase-E` - Phase E output (step types 11-14 only).
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="sec:stepgen-parameters">1.2. Parameters</h3>
<div class="ulist"><ul>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.position-scale` - Steps per position unit.
  This parameter is used for both output and feedback.
</p>
</li>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.maxvel` - Maximum velocity, in position units per second. If 0.0, has no effect.
</p>
</li>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.maxaccel` - Maximum accel/decel rate, in positions units per second squared.
  If 0.0, has no effect.
</p>
</li>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.frequency` - The current step rate, in steps per second.
</p>
</li>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.steplen` - Length of a step pulse (step type 0 and 1) or minimum time in a given state (step types 2-14), in nano-seconds.
</p>
</li>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.stepspace` - Minimum spacing between two step pulses (step types 0 and 1 only), in nano-seconds.
  Set to 0 to enable the stepgen <em>doublefreq</em> function. To use <em>doublefreq</em> the <a href="parallel-port.html#sub:parport-functions">parport reset function</a> must be enabled.
</p>
</li>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.dirsetup` - Minimum time from a direction change to the beginning of the next step pulse (step type 0 only), in nanoseconds.
</p>
</li>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.dirhold` - Minimum time from the end of a step pulse to a direction change (step type 0 only), in nanoseconds.
</p>
</li>
<li>
<p>
(float) <code>stepgen.`__&lt;chan&gt;__</code>.dirdelay` - Minimum time any step to a step in the opposite direction (step types 1-14 only), in nano-seconds.
</p>
</li>
<li>
<p>
(s32) <code>stepgen.`__&lt;chan&gt;__</code>.rawcounts` - The raw feedback count, updated by <em>make_pulses()</em>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>In position mode, the values of maxvel and maxaccel are used by the internal position loop to avoid generating step pulse trains that the motor cannot follow.
When set to values that are appropriate for the motor, even a large instantaneous change in commanded position will result in a smooth trapezoidal move to the new location.
The algorithm works by measuring both position error and velocity error, and calculating an acceleration that attempts to reduce both to zero at the same time.
For more details, including the contents of the <em>control equation</em> box, consult the code.</p></div>
<div class="paragraph"><p>In velocity mode, maxvel is a simple limit that is applied to the commanded velocity,
and maxaccel is used to ramp the actual frequency if the commanded velocity changes abruptly.
As in position mode, proper values for these parameters ensure that the motor can follow the generated pulse train.</p></div>
</div>
<div class="sect2">
<h3 id="sub:stepgen-step-types">1.3. Step Types</h3>
<div class="paragraph"><p>Step generator supports 15 different <em>step sequences</em>:</p></div>
<div class="paragraph"><div class="title">Step Type 0</div><p>Step type 0 is the standard step and direction type.
When configured for step type 0, there are four extra parameters that determine the exact timing of the step and direction signals.
In the following figure the meaning of these parameters is shown.
The parameters are in nanoseconds, but will be rounded up to an integer multiple of the thread period for the threaed that calls <em>make_pulses()</em>.
For example, if <em>make_pulses()</em> is called every 16&#8239;µs, and steplen is 20000, then the step pulses will be 2 x 16 = 32&#8239;µs long.
The default value for all four of the parameters is 1&#8239;ns, but the automatic rounding takes effect the first time the code runs.
Since one step requires <em>steplen</em> ns high and <em>stepspace</em> ns low, the maximum frequency is 1,000,000,000 divided by (<em>steplen</em> + <em>stepspace</em>)'.
If <em>maxfreq</em> is set higher than that limit, it will be lowered automatically.
If <em>maxfreq</em> is zero, it will remain zero, but the output frequency will still be limited.</p></div>
<div class="paragraph"><p>When using the parallel port driver the step frequency can be doubled using the <a href="parallel-port.html#sub:parport-functions">parport reset</a> function together with StepGen&#8217;s <em>doublefreq</em> setting.</p></div>
<div class="imageblock" id="fig:stepdir-timing" style="text-align:center;">
<div class="content">
<figure>
<img src="images/stepgen-type0.png" alt="images/stepgen-type0.png"/>
<figcaption class="title"> Figure 2. Step and Direction Timing</figcaption>
</figure>
</div>
</div>
<div class="paragraph"><div class="title">Step Type 1</div><p>Step type 1 has two outputs, up and down.
Pulses appear on one or the other, depending on the direction of travel.
Each pulse is <em>steplen</em> ns long, and the pulses are separated by at least <em>stepspace</em> ns.
The maximum frequency is the same as for step type 0.
If <em>maxfreq</em> is set higher than the limit it will be lowered.
If <em>maxfreq</em> is zero, it will remain zero but the output frequency will still be limited.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Do not use the parport reset function with step types 2 - 14.
Unexpected results can happen.</td>
</tr></table>
</div>
<div class="paragraph"><div class="title">Step Type 2 - 14</div><p>Step types 2 through 14 are state based, and have from two to five outputs.
On each step, a state counter is incremented or decremented.
The Two-and-Three-Phase, Four-Phase, and Five-Phase show the output patterns as a function of the state counter.
The maximum frequency is 1,000,000,000 divided by <em>steplen</em>, and as in the other modes, <em>maxfreq</em> will be lowered if it is above the limit.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<figure>
<img src="images/stepgen-type2-4.png" alt="Step Types: Two-and-Three-Phase"/>
<figcaption class="title"> Figure 3. Two-and-Three-Phase Step Types</figcaption>
</figure>
</div>
</div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<figure>
<img src="images/stepgen-type5-10.png" alt="Step Types: Four-Phase"/>
<figcaption class="title"> Figure 4. Four-Phase Step Types</figcaption>
</figure>
</div>
</div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<figure>
<img src="images/stepgen-type11-14.png" alt="Step Types: Five-Phase"/>
<figcaption class="title"> Figure 5. Five-Phase Step Types</figcaption>
</figure>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sub:stepgen-functions">1.4. Functions</h3>
<div class="paragraph"><p>The component exports three functions. Each function acts on all of
the step pulse generators - running different generators in different
threads is not supported.</p></div>
<div class="ulist"><ul>
<li>
<p>
(funct) <code>stepgen.make-pulses</code> - High speed function to generate and count pulses (no floating point).
</p>
</li>
<li>
<p>
(funct) <code>stepgen.update-freq</code> - Low speed function does position to velocity conversion, scaling and limiting.
</p>
</li>
<li>
<p>
(funct) <code>stepgen.capture-position</code> - Low speed function for feedback, updates latches and scales position.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The high speed function <em>stepgen.make-pulses</em> should be run in a very fast thread, from 10 to 50&#8239;µs depending on the capabilities of the computer.
That thread&#8217;s period determines the maximum step frequency,
since <em>steplen</em>, <em>stepspace</em>, <em>dirsetup</em>, <em>dirhold</em>, and <em>dirdelay</em> are all rounded up to a integer multiple of the thread periond in nanoseconds.
The other two functions can be called at a much lower rate.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec:pwmgen">2. PWMgen</h2>
<div class="sectionbody">
<div class="paragraph"><p>This component provides software based generation of PWM (Pulse Width Modulation) and PDM (Pulse Density Modulation) waveforms.
It is a realtime component only, and depending on CPU speed, etc, is capable of PWM frequencies from a few hundred Hertz at pretty good resolution,
to perhaps 10 kHz with limited resolution.</p></div>
<div class="listingblock">
<div class="title">Loading PWMgen</div>
<div class="content">
<pre><code>loadrt pwmgen output_type=&lt;config-array&gt;</code></pre>
</div></div>
<div class="paragraph"><p>The <em>&lt;config-array&gt;</em> is a series of comma separated decimal integers.
Each number causes a single PWM generator to be loaded, the value of the number determines the output type.
The following example will install three PWM generators.
There is no default value, if <em>&lt;config-array&gt;</em> is not specified, no PWM generators will be installed.
The maximum number of frequency generators is 8 (as defined by MAX_CHAN in pwmgen.c).
Each generator is independent, but all are updated by the same function(s) at the same time.
In the following descriptions, <em><em>&lt;chan&gt;</em></em> is the number of a specific generator.
The first generator is number 0.</p></div>
<div class="listingblock">
<div class="title">Loading PWMgen Example</div>
<div class="content">
<pre><code>loadrt pwmgen output_type=0,1,2</code></pre>
</div></div>
<div class="paragraph"><p>Will install three PWM generators.
The first will use an output of type <em>0</em> (PWM only), the next one will use a type 1 output (PWM and direction) and the third will use a type 2 output (UP and DOWN).
There is no default value, if <em>&lt;config-array&gt;</em> is not not specified, no PWM generator will be installed.
The maximum number of frequency generators is 8 (as defined by MAX_CHAN in pwmgen.c).
Each generator is independent, but all are updated by the same function(s), at the same time.
In the descriptions that follow, <em>&lt;chan&gt;</em> is the number of specific generators.
The numbering of PWM generators starts at 0.</p></div>
<div class="listingblock">
<div class="title">Unloading PWMgen</div>
<div class="content">
<pre><code>unloadrt pwmgen</code></pre>
</div></div>
<div class="sect2">
<h3 id="_output_types">2.1. Output Types</h3>
<div class="paragraph"><p>The PWM generator supports three different <em>output types</em>.</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>Output type 0</em> - PWM output pin only.
  Only positive commands are accepted, negative values are treated as zero (and will be affected by the parameter <em>min-dc</em> if it is non-zero).
</p>
</li>
<li>
<p>
<em>Output type 1</em> - PWM/PDM and direction pins.
  Positive and negative inputs will be output as positive and negative PWM.
  The direction pin is false for positive commands, and true for negative commands.
  If your control needs positive PWM for both CW and CCW use the <a href="../man/man9/abs.9.html">abs</a> component to convert your PWM signal to positive value,
  when a negative input is input.
</p>
</li>
<li>
<p>
<em>Output type 2</em> - UP and DOWN pins.
  For positive commands, the PWM signal appears on the up output, and the down output remains false.
  For negative commands, the PWM signal appears on the down output, and the up output remains false.
  Output type 2 is suitable for driving most H-bridges.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_pins">2.2. Pins</h3>
<div class="paragraph"><p>Each PWM generator will have the following pins:</p></div>
<div class="ulist"><ul>
<li>
<p>
(float) <code>pwmgen.`__&lt;chan&gt;__</code>.value` - Command value, in arbitrary units.
  Will be scaled by the <em>scale</em> parameter (see below).
</p>
</li>
<li>
<p>
(bit) <code>pwmgen.`__&lt;chan&gt;__</code>.enable` - Enables or disables the PWM generator outputs.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Each PWM generator will also have some of these pins, depending on the output type selected:</p></div>
<div class="ulist"><ul>
<li>
<p>
(bit) <code>pwmgen.`__&lt;chan&gt;__</code>.pwm` - PWM (or PDM) output, (output types 0 and 1 only).
</p>
</li>
<li>
<p>
(bit) <code>pwmgen.`__&lt;chan&gt;__</code>.dir` - Direction output (output type 1 only).
</p>
</li>
<li>
<p>
(bit) <code>pwmgen.`__&lt;chan&gt;__</code>.up` - PWM/PDM output for positive input value (output type 2 only).
</p>
</li>
<li>
<p>
(bit) <code>pwmgen.`__&lt;chan&gt;__</code>.down` - PWM/PDM output for negative input value (output type 2 only).
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_parameters">2.3. Parameters</h3>
<div class="ulist"><ul>
<li>
<p>
(float) <code>pwmgen.`__&lt;chan&gt;__</code>.scale` - Scaling factor to convert <code>value</code>  from arbitrary units to duty cycle.
  For example if scale is set to 4000 and the input value passed to the <code>pwmgen.`__&lt;chan&gt;__</code>.value` is 4000 then it will be 100% duty-cycle (always on).
  If the value is 2000 then it will be a 50% 25&#8239;Hz square wave.
</p>
</li>
<li>
<p>
(float) <code>pwmgen.`__&lt;chan&gt;__</code>.pwm-freq` - Desired PWM frequency, in Hz.
  If 0.0, generates PDM instead of PWM. If set higher than internal limits, next call of <em>update_freq()</em> will set it to the internal limit.
  If non-zero, and <em>dither</em> is false, next call of <em>update_freq()</em> will set it to the nearest integer multiple of the <em>make_pulses()</em> function period.
</p>
</li>
<li>
<p>
(bit) <code>pwmgen.`__&lt;chan&gt;__</code>.dither-pwm` - If true, enables dithering to achieve average PWM frequencies or duty cycles that are unobtainable with pure PWM.
  If false, both the PWM frequency and the duty cycle will be rounded to values that can be achieved exactly.
</p>
</li>
<li>
<p>
(float) <code>pwmgen.`__&lt;chan&gt;__</code>.min-dc` - Minimum duty cycle, between 0.0 and 1.0 (duty cycle will go to zero when disabled, regardless of this setting).
</p>
</li>
<li>
<p>
(float) <code>pwmgen.`__&lt;chan&gt;__</code>.max-dc` - Maximum duty cycle, between 0.0 and 1.0.
</p>
</li>
<li>
<p>
(float) <code>pwmgen.`__&lt;chan&gt;__</code>.curr-dc` - Current duty cycle - after all limiting and rounding (read only).
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_functions">2.4. Functions</h3>
<div class="paragraph"><p>The component exports two functions. Each function acts on all of the PWM generators - running different generators in different threads is not supported.</p></div>
<div class="ulist"><ul>
<li>
<p>
(funct) <code>pwmgen.make-pulses</code> - High speed function to generate PWM waveforms (no floating point).
  The high speed function <code>pwmgen.make-pulses</code> should be run in the base (fastest) thread, from 10 to 50&#8239;µs depending on the capabilities of the computer.
  That thread&#8217;s period determines the maximum PWM carrier frequency, as well as the resolution of the PWM or PDM signals.
  If the base thread is 50,000&#8239;ns then every 50&#8239;µs the module decides if it is time to change the state of the output.
  At 50% duty cycle and 25&#9239;Hz PWM frequency this means that the output changes state every (1/25)&#8239;s / 50&#8239;µs * 50% = 400 iterations.
  This also means that you have a 800 possible duty cycle values (without dithering).
</p>
</li>
<li>
<p>
(funct) <code>pwmgen.update</code> - Low speed function to scale and limit value and handle other parameters.
  This is the function of the module that does the more complicated mathematics to work out how many base-periods the output should be high for, and how many it should be low for.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec:encoder">3. Encoder</h2>
<div class="sectionbody">
<div class="paragraph"><p>This component provides software based counting of signals from quadrature (or single-pulse) encoders.
It is a realtime component only, and depending on CPU speed, latency, etc, is capable of maximum count rates of 10&#8239;kHz to perhaps up to 50&#8239;kHz.</p></div>
<div class="paragraph"><p>The base thread should be 1/2 count speed to allow for noise and timing variation.
For example if you have a 100 pulse per revolution encoder on the spindle and your maximum RPM is 3000 the maximum base thread should be 25&#8239;µs.
A 100 pulse per revolution encoder will have 400 counts.
The spindle speed of 3000&#8239;RPM = 50&#8239;RPS (revolutions per second). 400 * 50 = 20,000 counts per second or 50&#8239;µs between counts.</p></div>
<div class="paragraph"><p>The Encoder Counter Block Diagram is a block diagram of one channel of an encoder counter.</p></div>
<div class="imageblock" id="fig:encoder-block-diagram" style="text-align:center;">
<div class="content">
<figure>
<img src="images/encoder-block-diag.png" alt="images/encoder-block-diag.png"/>
<figcaption class="title"> Figure 6. Encoder Counter Block Diagram</figcaption>
</figure>
</div>
</div>
<div class="listingblock">
<div class="title">Loading Encoder</div>
<div class="content">
<pre><code>halcmd: loadrt encoder [num_chan=&lt;counters&gt;]</code></pre>
</div></div>
<div class="paragraph"><p><em>&lt;counters&gt;</em> is the number of encoder counters that you want to install.
If <em>num_chan</em> is not specified, three counters will be installed.
The maximum number of counters is 8 (as defined by MAX_CHAN in encoder.c).
Each counter is independent, but all are updated by the same function(s) at the same time.
In the following descriptions, <em>&lt;chan&gt;</em> is the number of a specific counter. The first counter is number 0.</p></div>
<div class="listingblock">
<div class="title">Unloading Encoder</div>
<div class="content">
<pre><code>halcmd: unloadrt encoder</code></pre>
</div></div>
<div class="sect2">
<h3 id="_pins_2">3.1. Pins</h3>
<div class="ulist"><ul>
<li>
<p>
<code>encoder._&lt;chan&gt;_.counter-mode</code> (bit, I/O) (default: FALSE) - Enables counter mode.
  When true, the counter counts each rising edge of the phase-A input, ignoring the value on phase-B.
  This is useful for counting the output of a single channel (non-quadrature) sensor. When false, it counts in quadrature mode.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.missing-teeth</code> (s32, In) (default: 0) - Enables the use
  of missing-tooth index. This allows a single IO pin to provide both
  position and index information. If the encoder wheel has 58 teeth with
  two missing, spaced as if there were 60(common for automotive crank
  sensors) then the position-scale should be set to 60 and
  missing-teeth to 2. To use this mode counter-mode should be set
  true. This mode will work for lathe threading but not for rigid
  tapping.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.counts</code> (s32, Out) - Position in encoder counts.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.counts-latched</code> (s32, Out) - Not used at this time.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.index-enable</code> (bit, I/O) - When True, <code>counts</code> and
  <code>position</code> are reset to zero on next rising edge of Phase Z.<br />
  At the same time, <code>index-enable</code> is reset to zero to indicate that the rising edge has occurred.
  The <code>index-enable</code> pin is bi-directional.
  If <code>index-enable</code> is False, the Phase Z channel of the encoder will be ignored, and the counter will count normally.
  The encoder driver will never set <code>index-enable</code> True. However, some other component may do so.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.latch-falling</code> (bit, In) (default: TRUE) - Not used at this time.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.latch-input</code> (bit, In) (default: TRUE) - Not used at this time.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.latch-rising</code> (bit, In) - Not used at this time.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.min-speed-estimate</code> (float, in) - Determine the minimum true velocity magnitude,
  at which velocity will be estimated as nonzero and position-interpolated will be interpolated.
  The units of <code>min-speed-estimate</code> are the same as the units of <code>velocity</code>.
  Scale factor, in counts per length unit.
  Setting this parameter too low will cause it to take a long time for velocity to go to 0 after encoder pulses have stopped arriving.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.phase-A</code> (bit, In) - Phase A of the quadrature encoder signal.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.phase-B</code> (bit, In) - Phase B of the quadrature encoder signal.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.phase-Z</code> (bit, In) - Phase Z (index pulse) of the quadrature encoder signal.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.position</code> (float, Out) - Position in scaled units (see <code>position-scale</code>).
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.position-interpolated</code> (float, Out) - Position in scaled units, interpolated between encoder counts.<br />
  The <code>position-interpolated</code> attempts to interpolate between encoder counts, based on the most recently measured velocity.
  Only valid when velocity is approximately constant and above <code>min-speed-estimate</code>.
  Do not use for position control, since its value is incorrect at low speeds, during direction reversals, and during speed changes.<br />
  However, it allows a low ppr encoder (including a one pulse per revolution <em>encoder</em>) to be used for lathe threading, and may have other uses as well.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.position-latched</code> (float, Out) - Not used at this time.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.position-scale</code> (float, I/O) - Scale factor, in counts per length unit. For example, if
  position-scale is 500, then 1000 counts of the encoder will be reported as a position of 2.0 units.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.rawcounts</code> (s32, In) - The raw count, as determined by update-counters.
  This value is updated more frequently than counts and position.
  It is also unaffected by reset or the index pulse.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.reset</code> (bit, In) - When True, force <em>counts</em> and <em>position</em> to zero immediately.
</p>
</li>
<li>
<p>
&#8216;encoder._&lt;chan&gt;_.velocity` (float, Out) - Velocity in scaled units per second.
  `encoder&#8217; uses an algorithm that greatly reduces quantization noise as compared to simply differentiating the <em>position</em> output.
  When the magnitude of the true velocity is below min-speed-estimate, the velocity output is 0.
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.x4-mode</code> (bit, I/O) (default: TRUE) - Enables times-4 mode.
  When true, the counter counts each edge of the quadrature waveform (four counts per full cycle).
  When false, it only counts once per full cycle.
  In counter-mode, this parameter is ignored. The 1x mode is useful for some jogwheels.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_parameters_2">3.2. Parameters</h3>
<div class="ulist"><ul>
<li>
<p>
<code>encoder._&lt;chan&gt;_.capture-position.time</code> (s32, RO)
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.capture-position.tmax</code> (s32, RW)
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.update-counters.time</code> (s32, RO)
</p>
</li>
<li>
<p>
<code>encoder._&lt;chan&gt;_.update-counter.tmax</code> (s32, RW)
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_functions_2">3.3. Functions</h3>
<div class="paragraph"><p>The component exports two functions.
Each function acts on all of the encoder counters - running different counters in different threads is not supported.</p></div>
<div class="ulist"><ul>
<li>
<p>
(funct) <code>encoder.update-counters</code> - High speed function to count pulses (no floating point).
</p>
</li>
<li>
<p>
(funct) <code>encoder.capture-position</code> - Low speed function to update latches and scale position.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec:pid">4. PID</h2>
<div class="sectionbody">
<div class="paragraph"><p>This component provides Proportional/Integral/Derivative control loops.
It is a realtime component only. For simplicity, this discussion assumes that we are talking about position loops,
however this component can be used to implement other feedback loops such as speed, torch height, temperature, etc.
The PID Loop Block Diagram is a block diagram of a single PID loop.</p></div>
<div class="imageblock" id="fig:pid-block-diag" style="text-align:center;">
<div class="content">
<figure>
<img src="images/pid-block-diag.png" alt="images/pid-block-diag.png"/>
<figcaption class="title"> Figure 7. PID Loop Block Diagram</figcaption>
</figure>
</div>
</div>
<div class="listingblock">
<div class="title">Loading PID</div>
<div class="content">
<pre><code>halcmd: loadrt pid [num_chan=&lt;loops&gt;] [debug=1]</code></pre>
</div></div>
<div class="paragraph"><p><em>&lt;loops&gt;</em> is the number of PID loops that you want to install.
If <em>num_chan</em> is not specified, one loop will be installed.
The maximum number of loops is 16 (as defined by MAX_CHAN in pid.c).
Each loop is completely independent. In the following descriptions, <em>&lt;loopnum&gt;</em> is the loop number of a specific loop.
The first loop is number 0.</p></div>
<div class="paragraph"><p>If <code>debug=1</code> is specified, the component will export a few extra pins that may be useful during debugging and tuning.
By default, the extra pins are not exported, to save shared memory space and avoid cluttering the pin list.</p></div>
<div class="listingblock">
<div class="title">Unloading PID</div>
<div class="content">
<pre><code>halcmd: unloadrt pid</code></pre>
</div></div>
<div class="sect2">
<h3 id="_pins_3">4.1. Pins</h3>
<div class="paragraph"><p>The three most important pins are</p></div>
<div class="ulist"><ul>
<li>
<p>
(float) <code>pid.`__&lt;loopnum&gt;__</code>.command` - The desired position, as commanded by another system component.
</p>
</li>
<li>
<p>
(float) <code>pid.`__&lt;loopnum&gt;__</code>.feedback` - The present position, as measured by a feedback device such as an encoder.
</p>
</li>
<li>
<p>
(float) <code>pid.`__&lt;loopnum&gt;__</code>.output` - A velocity command that attempts to move from the present position to the desired position.
</p>
</li>
</ul></div>
<div class="paragraph"><p>For a position loop, <code>.command</code> and <code>.feedback</code> are in position units.
For a linear axis, this could be inches, mm, meters, or whatever is relevant.
Likewise, for an angular axis, it could be degrees, radians, etc.
The units of the <code>.output</code> pin represent the change needed to make the feedback match the command.
As such, for a position loop <code>.output</code> is a velocity, in inches/s, mm/s, degrees/s, etc.
Time units are always seconds, and the velocity units match the position units.
If command and feedback are in meters, then output is in meters per second.</p></div>
<div class="paragraph"><p>Each loop has two pins which are used to monitor or control the general operation of the component.</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.error</em> - Equals <em>.command</em> minus <em>.feedback</em>.
</p>
</li>
<li>
<p>
<em>(bit) pid.<em>&lt;loopnum&gt;</em>.enable</em> - A bit that enables the loop.
  If <em>.enable</em> is false, all integrators are reset, and the output is forced to zero.
  If <em>.enable</em> is true, the loop operates normally.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Pins used to report saturation. Saturation occurs when the output of the PID block is at its maximum or minimum limit.</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>(bit) pid.<em>&lt;loopnum&gt;</em>.saturated</em> - True when output is saturated.
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.saturated_s</em> - The time the output has been saturated.
</p>
</li>
<li>
<p>
<em>(s32) pid.<em>&lt;loopnum&gt;</em>.saturated_count</em> - The time the output has been saturated.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The PID gains, limits, and other <em>tunable</em> features of the loop are available as pins so that they can be adjusted dynamically for more advanced tuning possibilities.</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.Pgain</em> - Proportional gain
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.Igain</em> - Integral gain
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.Dgain</em> - Derivative gain
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.bias</em> - Constant offset on output
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.FF0</em> - Zeroth order feedforward - output proportional to command (position).
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.FF1</em> - First order feedforward - output proportional to derivative of command (velocity).
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.FF2</em> - Second order feedforward - output proportional to 2<sup>nd</sup> derivative of command (acceleration).
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.deadband</em> - Amount of error that will be ignored
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.maxerror</em> - Limit on error
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.maxerrorI</em> - Limit on error integrator
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.maxerrorD</em> - Limit on error derivative
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.maxcmdD</em> - Limit on command derivative
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.maxcmdDD</em> - Limit on command 2<sup>nd</sup> derivative
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.maxoutput</em> - Limit on output value
</p>
</li>
</ul></div>
<div class="paragraph"><p>All <em>max*</em> limits are implemented so that if the value of this parameter is zero, there is no limit.</p></div>
<div class="paragraph"><p>If <em>debug=1</em> was specified when the component was installed, four additional pins will be exported:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.errorI</em> - Integral of error.
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.errorD</em> - Derivative of error.
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.commandD</em> - Derivative of the command.
</p>
</li>
<li>
<p>
<em>(float) pid.<em>&lt;loopnum&gt;</em>.commandDD</em> - 2<sup>nd</sup> derivative of the command.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_functions_3">4.2. Functions</h3>
<div class="paragraph"><p>The component exports one function for each PID loop.
This function performs all the calculations needed for the loop.
Since each loop has its own function, individual loops can be included in different threads and execute at different rates.</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>(funct) pid.<em>&lt;loopnum&gt;</em>.do_pid_calcs</em> - Performs all calculations
  for a single PID loop.
</p>
</li>
</ul></div>
<div class="paragraph"><p>If you want to understand the exact algorithm used to compute the output of the PID loop, refer to
- figure <a href="rtcomps.html#fig:pid-block-diag">PID Loop Block Diagram</a>,
- the comments at the beginning of <em>emc2/src/hal/components/pid.c</em>, and of course to
- the code itself.
The loop calculations are in the C function <em>calc_pid()</em>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec:simulated-encoder">5. Simulated Encoder</h2>
<div class="sectionbody">
<div class="paragraph"><p>The simulated encoder is exactly that.
It produces quadrature pulses with an index pulse, at a speed controlled by a HAL pin.
Mostly useful for testing.</p></div>
<div class="listingblock">
<div class="title">Loading sim-encoder</div>
<div class="content">
<pre><code>halcmd: loadrt sim-encoder num_chan=&lt;number&gt;</code></pre>
</div></div>
<div class="paragraph"><p><em>&lt;number&gt;</em> is the number of encoders that you want to simulate
If not specified, one encoder will be installed.
The maximum number is 8 (as defined by MAX_CHAN in sim_encoder.c).</p></div>
<div class="listingblock">
<div class="title">Unloading sim-encoder</div>
<div class="content">
<pre><code>halcmd: unloadrt sim-encoder</code></pre>
</div></div>
<div class="sect2">
<h3 id="_pins_4">5.1. Pins</h3>
<div class="ulist"><ul>
<li>
<p>
(float) <code>sim-encoder.`__&lt;chan-num&gt;__</code>.speed` - The speed command for the simulated shaft.
</p>
</li>
<li>
<p>
(bit) <code>sim-encoder.`__&lt;chan-num&gt;__</code>.phase-A` - Quadrature output.
</p>
</li>
<li>
<p>
(bit) <code>sim-encoder.`__&lt;chan-num&gt;__</code>.phase-B` - Quadrature output.
</p>
</li>
<li>
<p>
(bit) <code>sim-encoder.`__&lt;chan-num&gt;__</code>.phase-Z` - Index pulse output.
</p>
</li>
</ul></div>
<div class="paragraph"><p>When <code>.speed</code> is positive, <code>.phase-A</code> leads <code>.phase-B</code>.</p></div>
</div>
<div class="sect2">
<h3 id="_parameters_3">5.2. Parameters</h3>
<div class="ulist"><ul>
<li>
<p>
(u32) <code>sim-encoder.`__&lt;chan-num&gt;__</code>.ppr` - Pulses Per Revolution.
</p>
</li>
<li>
<p>
(float) <code>sim-encoder.`__&lt;chan-num&gt;__</code>.scale` - Scale Factor for <code>.speed</code>.
  The default is 1.0, which means that <code>.speed</code> is in revolutions per second.
  Change to 60 for RPM, to 360 for degrees per second, 6.283185 (= 2*&pi;) for radians per second, etc.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Note that pulses per revolution is not the same as counts per revolution.
A pulse is a complete quadrature cycle.
Most encoder counters will count four times during one complete cycle.</p></div>
</div>
<div class="sect2">
<h3 id="_functions_4">5.3. Functions</h3>
<div class="paragraph"><p>The component exports two functions. Each function affects all simulated encoders.</p></div>
<div class="ulist"><ul>
<li>
<p>
(funct) <code>sim-encoder.make-pulses</code> - High speed function to generate quadrature pulses (no floating point).
</p>
</li>
<li>
<p>
(funct) <code>sim-encoder.update-speed</code> - Low speed function to read <code>.speed</code>, do scaling, and set up <code>.make-pulses</code>.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec:debounce">6. Debounce</h2>
<div class="sectionbody">
<div class="paragraph"><p>Debounce is a realtime component that can filter the glitches created by mechanical switch contacts.
It may also be useful in other applications where short pulses are to be rejected.</p></div>
<div class="listingblock">
<div class="title">Loading debounce</div>
<div class="content">
<pre><code>halcmd: loadrt debounce cfg=&lt;config-string&gt;</code></pre>
</div></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<em>&lt;config-string&gt;</em>
</dt>
<dd>
<p>
Is a series of comma separated decimal integers.
  Each number install  a group of identical debounce filters, the number determines how many filters are in the group.
</p>
</dd>
</dl></div>
<div class="listingblock">
<div class="title">Loading debounce Example</div>
<div class="content">
<pre><code>halcmd: loadrt debounce cfg=1,4,2</code></pre>
</div></div>
<div class="paragraph"><p>will install three groups of filters. Group 0 contains one filter, group 1 contains four, and group 2 contains two filters.
The default value for <em>&lt;config-string&gt;</em> is "1" which will install a single group containing a single filter.
The maximum number of groups 8 (as defined by MAX_GROUPS in debounce.c).
The maximum number of filters in a group is limited only by shared memory space.
Each group is completely independent.
All filters in a single group are identical, and they are all updated by the same function at the same time.
In the following descriptions, <em>&lt;G&gt;</em> is the group number and <em>&lt;F&gt;</em> is the filter number within the group.
The first filter is group 0, filter 0.</p></div>
<div class="listingblock">
<div class="title">Unloading debounce</div>
<div class="content">
<pre><code>halcmd: unloadrt debounce</code></pre>
</div></div>
<div class="sect2">
<h3 id="_pins_5">6.1. Pins</h3>
<div class="paragraph"><p>Each individual filter has two pins.</p></div>
<div class="ulist"><ul>
<li>
<p>
(bit) <code>debounce.`__&lt;G&gt;__.__&lt;F&gt;__</code>.in` - Input of filter <em>&lt;F&gt;</em> in group <em>&lt;G&gt;</em>.
</p>
</li>
<li>
<p>
(bit) <code>debounce.`__&lt;G&gt;__.__&lt;F&gt;__</code>.out` - Output of filter <em>&lt;F&gt;</em> in group <em>&lt;G&gt;</em>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_parameters_4">6.2. Parameters</h3>
<div class="paragraph"><p>Each group of filters has one parameter<span class="footnote"><br />[Each individual filter also has an internal state variable.
There is a compile time switch that can export that variable as a parameter.
This is intended for testing, and simply wastes shared memory under normal circumstances.]<br /></span>.</p></div>
<div class="ulist"><ul>
<li>
<p>
(s32) <code>debounce.`__&lt;G&gt;__</code>.delay` - Filter delay for all filters in group <em>&lt;G&gt;</em>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The filter delay is in units of thread periods. The minimum delay is zero.
The output of a zero delay filter exactly follows its input - it doesn&#8217;t filter anything.
As <code>.delay</code> increases, longer and longer glitches are rejected.
If <code>.delay</code> is 4, all glitches less than or equal to four thread periods will be rejected.</p></div>
</div>
<div class="sect2">
<h3 id="_functions_5">6.3. Functions</h3>
<div class="paragraph"><p>Each group of filters has one function, which updates all the filters in that group <em>simultaneously</em>.
Different groups of filters can be updated from different threads at different periods.</p></div>
<div class="ulist"><ul>
<li>
<p>
(funct) <code>debounce.</code><em>&lt;G&gt;</em> - Updates all filters in group <em>&lt;G&gt;</em>.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec:siggen">7. SigGen</h2>
<div class="sectionbody">
<div class="paragraph"><p>SigGen is a realtime component that generates square, triangle, and sine waves. It is primarily used for testing.</p></div>
<div class="listingblock">
<div class="title">Loading siggen</div>
<div class="content">
<pre><code>halcmd: loadrt siggen [num_chan=&lt;chans&gt;]</code></pre>
</div></div>
<div class="dlist"><dl>
<dt class="hdlist1">
&lt;chans&gt;
</dt>
<dd>
<p>
is the number of signal generators that you want to install.
  If <em>numchan</em> is not specified, one signal generator will be installed.
  The maximum number of generators is 16 (as defined by MAX_CHAN in siggen.c).
  Each generator is completely independent.
  In the following descriptions is
</p>
</dd>
<dt class="hdlist1">
<em>&lt;chan&gt;</em>
</dt>
<dd>
<p>
the number of a specific signal generator (the numbers start at 0).
</p>
</dd>
</dl></div>
<div class="listingblock">
<div class="title">Unloading siggen</div>
<div class="content">
<pre><code>halcmd: unloadrt siggen</code></pre>
</div></div>
<div class="sect2">
<h3 id="_pins_6">7.1. Pins</h3>
<div class="paragraph"><p>Each generator has five output pins.</p></div>
<div class="ulist"><ul>
<li>
<p>
(float) <code>siggen.`__&lt;chan&gt;__</code>.sine` - Sine wave output.
</p>
</li>
<li>
<p>
(float) <code>siggen.`__&lt;chan&gt;__</code>.cosine` - Cosine output.
</p>
</li>
<li>
<p>
(float) <code>siggen.`__&lt;chan&gt;__</code>.sawtooth` - Sawtooth output.
</p>
</li>
<li>
<p>
(float) <code>siggen.`__&lt;chan&gt;__</code>.triangle` - Triangle wave output.
</p>
</li>
<li>
<p>
(float) <code>siggen.`__&lt;chan&gt;__</code>.square` - Square wave output.
</p>
</li>
</ul></div>
<div class="paragraph"><p>All five outputs have the same frequency, amplitude, and offset.</p></div>
<div class="paragraph"><p>In addition to the output pins, there are three control pins:</p></div>
<div class="ulist"><ul>
<li>
<p>
(float) <code>siggen.`__&lt;chan&gt;__</code>.frequency` - Sets the frequency in Hertz, default value is 1 Hz.
</p>
</li>
<li>
<p>
(float) <code>siggen.`__&lt;chan&gt;__</code>.amplitude` - Sets the peak amplitude of the output waveforms, default is 1.
</p>
</li>
<li>
<p>
(float) <code>siggen.`__&lt;chan&gt;__</code>.offset` - Sets DC offset of the output waveforms, default is 0.
</p>
</li>
</ul></div>
<div class="paragraph"><p>For example, if <code>siggen.0.amplitude</code> is 1.0 and <code>siggen.0.offset</code> is 0.0,
the outputs will swing from -1.0 to +1.0. If <code>siggen.0.amplitude</code> is 2.5 and <code>siggen.0.offset</code> is 10.0, then the outputs will swing from 7.5 to 12.5.</p></div>
</div>
<div class="sect2">
<h3 id="_parameters_5">7.2. Parameters</h3>
<div class="paragraph"><p>None. <span class="footnote"><br />[Prior to version 2.1, frequency, amplitude, and offset were parameters.
They were changed to pins to allow control by other components.]<br /></span></p></div>
</div>
<div class="sect2">
<h3 id="_functions_6">7.3. Functions</h3>
<div class="ulist"><ul>
<li>
<p>
(funct) <code>siggen.`__&lt;chan&gt;__</code>.update` - Calculates new values for all five outputs.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec:lut5">8. <code>lut5</code></h2>
<div class="sectionbody">
<div class="paragraph"><p>The <code>lut5</code> component is a 5 input logic component based on a look up table.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>lut5</code> does not require a floating point thread.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Loading <code>lut5</code></div>
<div class="content">
<pre><code>loadrt lut5 [count=N|names=name1[,name2...]]
addf lut5.N servo-thread | base-thread
setp lut5.N.function 0xN</code></pre>
</div></div>
<div class="paragraph"><div class="title"><code>lut5</code> Computing Function</div><p>To compute the hexadecimal number for the function starting from the top put a 1 or 0 to indicate if that row would be true or false.
Next write down every number in the output column starting from the top and writing them from right to left.
This will be the binary number.
Using a calculator with a program view like the one in Ubuntu enter the binary number and then convert it to hexadecimal and that will be the value for function.</p></div>
<div class="tableblock">
<table rules="all" class="tableblock"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. <code>lut5</code> Look Up Table</caption>
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<thead>
<tr>
<th align="center" valign="top">Bit 4 </th>
<th align="center" valign="top">Bit 3 </th>
<th align="center" valign="top">Bit 2 </th>
<th align="center" valign="top">Bit 1 </th>
<th align="center" valign="top">Bit 0 </th>
<th align="center" valign="top">Output</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table"></p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><div class="title"><code>lut5</code> Two Inputs Example</div><p>In the following table we have selected the output state for each line that we wish to be true.</p></div>
<div class="tableblock">
<table rules="all" class="tableblock"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 2. <code>lut5</code> Two Inputs Example Look Up Table</caption>
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<thead>
<tr>
<th align="center" valign="top">Bit 4 </th>
<th align="center" valign="top">Bit 3 </th>
<th align="center" valign="top">Bit 2 </th>
<th align="center" valign="top">Bit 1 </th>
<th align="center" valign="top">Bit 0 </th>
<th align="center" valign="top">Output</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">0</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
<td align="center" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Looking at the output column of our example we want the output to be on when Bit 0 or Bit 0 and Bit1 is on and nothing else.
The binary number is <em>b1010</em> (rotate the output 90 degrees CW).
Enter this number into the calculator then change the display to hexadecimal and the number needed for function is <em>0xa</em>.
The hexadecimal prefix is <em>0x</em>.</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2023-06-17 21:52:11 CEST
</div>
</div>
</body>
</html>
