<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 9.0.0rc2" />
<title>QtVCP: Building Custom Widgets</title>
<link rel="stylesheet" href="..//asciidoc.css" type="text/css" />


<link rel="stylesheet" href="..//linuxcnc.css" type="text/css" />
<script type="text/javascript" src="..//asciidoc.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
<h1>QtVCP: Building Custom Widgets</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="cha:qtvcp:custom-widgets">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph"><p>Building custom widgets allows one to <strong>use the Qt Designer editor to place a custom widget</strong>
<em>rather than doing it manually in a handler file</em>.</p></div>
<div class="paragraph"><p>A useful custom widgets would be a great way to contribute back to LinuxCNC.</p></div>
<div class="sect2">
<h3 id="_widgets">1.1. Widgets</h3>
<div class="paragraph"><p><strong>Widget</strong> is the <em>general name for the UI objects</em> such as buttons and labels in PyQt.</p></div>
<div class="paragraph"><p>There are also <strong>special widgets made for LinuxCNC</strong> that make integration easier.</p></div>
<div class="paragraph"><p>All these widgets can be <em>placed with Qt Designer editor</em> - allowing one to <em>see the result</em>
before actually loading the panel in LinuxCNC.</p></div>
</div>
<div class="sect2">
<h3 id="_qt_designer">1.2. Qt Designer</h3>
<div class="paragraph"><p><strong>Qt Designer</strong> is a <em>WYSIWYG (What You See is What You Get) editor for
placing PyQt widgets</em>.</p></div>
<div class="paragraph"><p>It&#8217;s original intend was for building the graphic widgets for programs.<br />
We leverage it to <strong>build screens and panels for LinuxCNC</strong>.</p></div>
<div class="paragraph"><p>In Qt Designer, on the left side of the editor, you find <strong>three categories of LinuxCNC widgets</strong>:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>HAL only widgets</em>.
</p>
</li>
<li>
<p>
<em>LinuxCNC controller widgets</em>.
</p>
</li>
<li>
<p>
<em>dialog widgets</em>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>For Qt Designer to <em>add custom widgets</em> to it&#8217;s editor it must have a <strong>plugin</strong> added to the right folder.</p></div>
</div>
<div class="sect2">
<h3 id="_initialization_process">1.3. Initialization Process</h3>
<div class="paragraph"><p>QtVCP does <em>extra setup</em> for <strong>widgets subclassed from <code>_HALWidgetBase</code></strong>,
aka "HAL-ified" widgets.</p></div>
<div class="paragraph"><p>This includes:</p></div>
<div class="ulist"><ul>
<li>
<p>
Injecting <em>important variables</em>,
</p>
</li>
<li>
<p>
Calling an <em>extra setup function</em>
</p>
</li>
<li>
<p>
Calling a <em>closing cleanup function</em> at shutdown.
</p>
</li>
</ul></div>
<div class="paragraph"><p>These functions are not called when the Qt Designer editor displays the widgets.</p></div>
<div class="paragraph"><p>When QtVCP builds a screen from the <code>.ui</code> file:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
It searches for all the HAL-ified widgets.
</p>
</li>
<li>
<p>
It finds the <code>ScreenOptions</code> widget, to collect information it needs to inject into the other widgets
</p>
</li>
<li>
<p>
It instantiates each widget and if it is a HAL-ified widget, calls the <code>hal_init()</code> function.<br />
  <strong><code>hal_init()</code></strong> is defined in the base class and it:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Adds variables such as the preference file to every HAL-ified widget.
</p>
</li>
<li>
<p>
Call <code>+_hal_init()+</code> on the widget.<br />
   <code>+_hal_init()+</code> allows the widget designer to do setup that requires access to the extra variables.
</p>
</li>
</ol></div>
</li>
</ol></div>
<div class="paragraph"><p>Here is a description of the extra variables injected into "HAL-ified" widgets:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong><code>self.HAL_GCOMP</code></strong>
</dt>
<dd>
<p>
The <em>HAL component instance</em>
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.HAL_NAME</code></strong>
</dt>
<dd>
<p>
This <em>widget&#8217;s name</em> as a string
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.QT_OBJECT_</code></strong>
</dt>
<dd>
<p>
This <em>widget&#8217;s object instance</em>
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.QTVCP_INSTANCE_</code></strong>
</dt>
<dd>
<p>
The <em>very top level parent</em> of the screen
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.PATHS_</code></strong>
</dt>
<dd>
<p>
The <em>QtVCP&#8217;s path library instance</em>
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.PREFS_</code></strong>
</dt>
<dd>
<p>
The <em>optional preference file instance</em>
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.SETTINGS_</code></strong>
</dt>
<dd>
<p>
The <code>Qsettings</code> <em>object instance</em>
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_cleanup_process">1.4. cleanup process</h3>
<div class="paragraph"><p>When QtVCP closes, it calls the <strong><code>+_hal_cleanup()+</code></strong> function <em>on all HAL-ified widgets</em>.</p></div>
<div class="paragraph"><p>The base class creates an empty <code>+_hal_cleanup()+</code> function, which can be redefined in the custom widget subclass.</p></div>
<div class="paragraph"><p>This can be used to do such things as record preferences, etc.</p></div>
<div class="paragraph"><p>This function is not called when the Qt Designer editor displays the widgets.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_hal_widgets">2. Custom HAL Widgets</h2>
<div class="sectionbody">
<div class="paragraph"><p>HAL widgets are the simplest to show example of.<br />
<code>qtvcp/widgets/simple_widgets.py</code> holds many HAL only widgets.</p></div>
<div class="paragraph"><p>Lets look at a snippet of <code>simple_widgets.py</code>:</p></div>
<div class="paragraph"><div class="title">In the <em>Imports</em> section</div><p>This is where we import libraries that our widget class needs.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/env python3</span></span>

<span style="font-style: italic"><span style="color: #9A1900">###############################</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># Imports</span></span>
<span style="font-style: italic"><span style="color: #9A1900">###############################</span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5 <span style="font-weight: bold"><span style="color: #000080">import</span></span> QtWidgets                     <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;1&gt;</b></span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>widget_baseclass <span style="color: #990000">\</span>
    <span style="font-weight: bold"><span style="color: #000080">import</span></span> _HalWidgetBase<span style="color: #990000">,</span> _HalSensitiveBase    <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;2&gt;</b></span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> hal                                      <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;3&gt;</b></span></span></tt></pre></div></div>
<div class="paragraph"><p>In this case we need access to:</p></div>
<div class="colist arabic"><ol>
<li>
<p>
PyQt&#8217;s QtWidgets library,
</p>
</li>
<li>
<p>
LinuxCNC&#8217;s HAL library, and
</p>
</li>
<li>
<p>
QtVCP&#8217;s widget <code>baseclass</code> 's <strong><code>_HalSensitiveBase</code></strong> for <em>automatic
    HAL pin setup</em> and to <em>disable/enable the widget</em> (also known as
    input sensitivity).<br />
    There is also <code>_HalToggleBase</code>, and <code>_HalScaleBase</code> functions available in the library.<code>_HalToggleBase</code>, and <code>_HalScaleBase</code>.
</p>
</li>
</ol></div>
<div class="paragraph"><div class="title">In the <em>WIDGET</em> section</div><p>Here is a <em>custom widget</em> based on PyQt&#8217;s <strong><code>QGridLayout</code></strong> widget.</p></div>
<div class="paragraph"><p><code>QGridLayout</code> allows one to:</p></div>
<div class="ulist"><ul>
<li>
<p>
<em>Place objects in a grid</em> fashion.
</p>
</li>
<li>
<p>
<em>Enable/disable all widgets inside it</em> based on a <strong>HAL pin state</strong>.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">######################</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># WIDGET</span></span>
<span style="font-style: italic"><span style="color: #9A1900">######################</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">Lcnc_GridLayout</span></span><span style="color: #990000">(</span>QtWidgets<span style="color: #990000">.</span>QWidget<span style="color: #990000">,</span> _HalSensitiveBase<span style="color: #990000">):</span>    <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;1&gt;</b></span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent <span style="color: #990000">=</span> None<span style="color: #990000">):</span>                          <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;2&gt;</b></span></span>
        <span style="font-weight: bold"><span style="color: #000000">super</span></span><span style="color: #990000">(</span>GridLayout<span style="color: #990000">,</span> self<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>                <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;3&gt;</b></span></span></tt></pre></div></div>
<div class="paragraph"><p>Line by Line:</p></div>
<div class="colist arabic"><ol>
<li>
<p>
This defines the <em>class name</em> and the <em>libraries it inherits from</em>.<br />
    This class, named <code>Lcnc_GridLayout</code>, inherits the functions of
    <code>QWidget</code> and <code>+_HalSensitiveBase+</code>.<br />
    <code>+_HalSensitiveBase+</code> is <em>subclass</em> of <strong><code>+_HalWidgetBase+</code></strong>, the
    <em>base class of most QtVCP widgets</em>, meaning it has all the functions
    of <code>+_HalWidgetBase+</code> plus the functions of <code>+_HalSensitiveBase+</code>.<br />
    It adds the function to make the widget be enabled or disabled based
    on a HAL input BIT pin.
</p>
</li>
<li>
<p>
This is the function <em>called when the widget is first made</em> (said
    instantiated) - this is pretty standard.
</p>
</li>
<li>
<p>
This function initializes our widget&#8217;s <strong><code>Super</code> classes</strong>.<br />
    <code>Super</code> just means the <em>inherited baseclasses</em>, that is <code>QWidget</code>
    and <code>_HalSensitiveBase</code>.<br />
    Pretty standard other than the widget name will change.
</p>
</li>
</ol></div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_controller_widgets_using_code_status_code">3. Custom Controller Widgets Using <code>STATUS</code></h2>
<div class="sectionbody">
<div class="paragraph"><p>Widget that interact with LinuxCNC&#8217;s controller are only a little more complicated and they require some <em>extra libraries</em>.</p></div>
<div class="paragraph"><p>In this cut down example we will add properties that can be changed in Qt Designer.</p></div>
<div class="paragraph"><p>This LED indicator widget will respond to selectable LinuxCNC controller states.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/env python3</span></span>

<span style="font-style: italic"><span style="color: #9A1900">###############################</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># Imports</span></span>
<span style="font-style: italic"><span style="color: #9A1900">###############################</span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5<span style="color: #990000">.</span>QtCore <span style="font-weight: bold"><span style="color: #000080">import</span></span> pyqtProperty
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>led_widget <span style="font-weight: bold"><span style="color: #000080">import</span></span> LED
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>core <span style="font-weight: bold"><span style="color: #000080">import</span></span> Status

<span style="font-style: italic"><span style="color: #9A1900">###########################################</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># **** instantiate libraries section **** #</span></span>
<span style="font-style: italic"><span style="color: #9A1900">###########################################</span></span>
STATUS <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Status</span></span><span style="color: #990000">()</span>

<span style="font-style: italic"><span style="color: #9A1900">##########################################</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># custom widget class definition</span></span>
<span style="font-style: italic"><span style="color: #9A1900">##########################################</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">StateLED</span></span><span style="color: #990000">(</span>LED<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">=</span>None<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000000">super</span></span><span style="color: #990000">(</span>StateLED<span style="color: #990000">,</span> self<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>has_hal_pins <span style="color: #990000">=</span> False
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setState</span></span><span style="color: #990000">(</span>False<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>is_estopped <span style="color: #990000">=</span> False
        self<span style="color: #990000">.</span>is_on <span style="color: #990000">=</span> False
        self<span style="color: #990000">.</span>invert_state <span style="color: #990000">=</span> False

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_hal_init</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>is_estopped<span style="color: #990000">:</span>
            STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-estop'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span>self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>True<span style="color: #990000">))</span>
            STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-estop-reset'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span>self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>False<span style="color: #990000">))</span>
        <span style="font-weight: bold"><span style="color: #0000FF">elif</span></span> self<span style="color: #990000">.</span>is_on<span style="color: #990000">:</span>
            STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-on'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span>self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>True<span style="color: #990000">))</span>
            STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-off'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span>self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>False<span style="color: #990000">))</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> data<span style="color: #990000">):</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>invert_state<span style="color: #990000">:</span>
                data <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> data
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">change_state</span></span><span style="color: #990000">(</span>data<span style="color: #990000">)</span>

    <span style="font-style: italic"><span style="color: #9A1900">#########################################################################</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># Qt Designer properties setter/getters/resetters</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">########################################################################</span></span>

    <span style="font-style: italic"><span style="color: #9A1900"># invert status</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">set_invert_state</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> data<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>invert_state <span style="color: #990000">=</span> data
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">get_invert_state</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>invert_state
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">reset_invert_state</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>invert_state <span style="color: #990000">=</span> False

    <span style="font-style: italic"><span style="color: #9A1900"># machine is estopped status</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">set_is_estopped</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> data<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>is_estopped <span style="color: #990000">=</span> data
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">get_is_estopped</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>is_estopped
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">reset_is_estopped</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>is_estopped <span style="color: #990000">=</span> False

    <span style="font-style: italic"><span style="color: #9A1900"># machine is on status</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">set_is_on</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> data<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>is_on <span style="color: #990000">=</span> data
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">get_is_on</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>is_on
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">reset_is_on</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>is_on <span style="color: #990000">=</span> False

    <span style="font-style: italic"><span style="color: #9A1900">#######################################</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># Qt Designer properties</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">#######################################</span></span>
    invert_state_status <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">pyqtProperty</span></span><span style="color: #990000">(</span>bool<span style="color: #990000">,</span> get_invert_state<span style="color: #990000">,</span> set_invert_state<span style="color: #990000">,</span> reset_invert_state<span style="color: #990000">)</span>
    is_estopped_status <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">pyqtProperty</span></span><span style="color: #990000">(</span>bool<span style="color: #990000">,</span> get_is_estopped<span style="color: #990000">,</span> set_is_estopped<span style="color: #990000">,</span> reset_is_estopped<span style="color: #990000">)</span>
    is_on_status <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">pyqtProperty</span></span><span style="color: #990000">(</span>bool<span style="color: #990000">,</span> get_is_on<span style="color: #990000">,</span> set_is_on<span style="color: #990000">,</span> reset_is_on<span style="color: #990000">)</span></tt></pre></div></div>
<div class="sect2">
<h3 id="_in_the_em_imports_em_section">3.1. In The <em>Imports</em> Section</h3>
<div class="paragraph"><p>This is where we import libraries that our widget class needs.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/env python3</span></span>

<span style="font-style: italic"><span style="color: #9A1900">###############################</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># Imports</span></span>
<span style="font-style: italic"><span style="color: #9A1900">###############################</span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5<span style="color: #990000">.</span>QtCore <span style="font-weight: bold"><span style="color: #000080">import</span></span> pyqtProperty       <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;1&gt;</b></span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>led_widget <span style="font-weight: bold"><span style="color: #000080">import</span></span> LED    <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;2&gt;</b></span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>core <span style="font-weight: bold"><span style="color: #000080">import</span></span> Status               <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;3&gt;</b></span></span></tt></pre></div></div>
<div class="paragraph"><p>We import</p></div>
<div class="colist arabic"><ol>
<li>
<p>
<code>pyqtProperty</code> so we can interact with the Qt Designer editor,
</p>
</li>
<li>
<p>
<code>LED</code> because our custom widget is based on it,
</p>
</li>
<li>
<p>
<code>Status</code> because it gives us status messages from LinuxCNC.<br />
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_in_the_em_instantiate_libraries_em_section">3.2. In The <em>Instantiate Libraries</em> Section</h3>
<div class="paragraph"><p>Here we create the <code>Status</code> library instance:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">###########################################</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># **** instantiate libraries section **** #</span></span>
<span style="font-style: italic"><span style="color: #9A1900">###########################################</span></span>
STATUS <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Status</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p>Typically we instantiated the library <em>outside of the widget class</em> so
that the reference to it is <strong>global</strong> - meaning you don&#8217;t need to use <code>self.</code> in front of it.</p></div>
<div class="paragraph"><p>By convention we use <em>all capital</em> letters in the name for global references.</p></div>
</div>
<div class="sect2">
<h3 id="_in_the_em_custom_widget_class_definition_em_section">3.3. In The <em>Custom Widget Class Definition</em> Section</h3>
<div class="paragraph"><p>This is the meat and potatoes of our custom widget.</p></div>
<div class="listingblock">
<div class="title">Class definition and instance initialization function</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">StateLed</span></span><span style="color: #990000">(</span>LED<span style="color: #990000">):</span>                            <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;1&gt;</b></span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">=</span>None<span style="color: #990000">):</span>            <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;2&gt;</b></span></span>
        <span style="font-weight: bold"><span style="color: #000000">super</span></span><span style="color: #990000">(</span>StateLed<span style="color: #990000">,</span> self<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>  <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;3&gt;</b></span></span>
        self<span style="color: #990000">.</span>has_hal_pins <span style="color: #990000">=</span> False               <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;4&gt;</b></span></span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setState</span></span><span style="color: #990000">(</span>False<span style="color: #990000">)</span>                    <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;5&gt;</b></span></span>
        self<span style="color: #990000">.</span>is_estopped <span style="color: #990000">=</span> False
        self<span style="color: #990000">.</span>is_on <span style="color: #990000">=</span> False
        self<span style="color: #990000">.</span>invert_state <span style="color: #990000">=</span> False</tt></pre></div></div>
<div class="colist arabic"><ol>
<li>
<p>
Defines the <strong>name</strong> <em>of our custom widget</em> and what other <em>class it inherits from</em>.<br />
    In this case we inherit <code>LED</code> - a QtVCP widget that represents a status light.
</p>
</li>
<li>
<p>
Typical of most widgets - called when the widget is first made.
</p>
</li>
<li>
<p>
Typical of most widgets - calls the parent (super) widget initialization code.
</p>
<div class="paragraph"><p>Then we set some attributes:</p></div>
</li>
<li>
<p>
Inherited from <code>Lcnc_Led</code> - we set it here so no HAL pin is made.
</p>
</li>
<li>
<p>
Inherited from <code>Lcnc_led</code> - we set it to make sure the LED is off.
</p>
</li>
</ol></div>
<div class="paragraph"><p>The other attributes are for the selectable options of our widget.</p></div>
<div class="listingblock">
<div class="title">Widget&#8217;s HAL initialization function</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_hal_init</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>is_estopped<span style="color: #990000">:</span>
            STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-estop'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span>self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>True<span style="color: #990000">))</span>
            STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-estop-reset'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span>self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>False<span style="color: #990000">))</span>
        <span style="font-weight: bold"><span style="color: #0000FF">elif</span></span> self<span style="color: #990000">.</span>is_on<span style="color: #990000">:</span>
            STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-on'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span>self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>True<span style="color: #990000">))</span>
            STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-off'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span>self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>False<span style="color: #990000">))</span></tt></pre></div></div>
<div class="paragraph"><p>This function connects <code>STATUS</code> (LinuxCNC status message library) to our widget,
so that the LED will on or off based on the selected state of the controller.</p></div>
<div class="paragraph"><p>We have two states we can choose from <code>is_estopped</code> or <code>is_on</code>.<br />
Depending on which is active our widget get connected to the appropriate STATUS messages.</p></div>
<div class="paragraph"><p><strong><code>+_hal_init()+</code></strong> is <em>called on each widget that inherits</em> <code>+_HalWidgetBase+</code>,
when QtVCP first builds the screen.<br />
You might wonder why it&#8217;s called on this widget since we didn&#8217;t have <code>+_HalWidgetBase+</code> in our class definition (<code>class Lcnc_State_Led(Lcnc_Led):</code>) -
it&#8217;s called because <code>Lcnc_Led</code> inherits <code>+_HalWidgetBase+</code>.</p></div>
<div class="paragraph"><p>In this function you have access to some extra information (though we don&#8217;t use them in this example):</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong><code>self.HAL_GCOMP</code></strong>
</dt>
<dd>
<p>
the <em>HAL component</em> instance
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.HAL_NAME</code></strong>
</dt>
<dd>
<p>
This <em>widget&#8217;s name</em> as a string
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.QT_OBJECT_</code></strong>
</dt>
<dd>
<p>
This <em>widget&#8217;s PyQt object instance</em>
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.QTVCP_INSTANCE_</code></strong>
</dt>
<dd>
<p>
The <em>very top level parent</em> of the screen
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.PATHS_</code></strong>
</dt>
<dd>
<p>
The <em>instance of QtVCP&#8217;s path</em> library
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.PREFS_</code></strong>
</dt>
<dd>
<p>
the <em>instance of an optional preference file</em>
</p>
</dd>
<dt class="hdlist1">
<strong><code>self.SETTINGS_</code></strong>
</dt>
<dd>
<p>
the <code>Qsettings</code> <em>object</em>
</p>
</dd>
</dl></div>
<div class="paragraph"><p>We could use this information to create HAL pins or look up image paths etc.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-estop'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span>self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>True<span style="color: #990000">))</span></tt></pre></div></div>
<div class="paragraph"><p>Lets look at this line more closely:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>STATUS</code> is very common theme is widget building.<br />
  <code>STATUS</code> uses <code>GObject</code> message system to send messages to widgets that register to it.<br />
  This line is the registering process.
</p>
</li>
<li>
<p>
<code>state-estop</code> is the message we wish to listen for and act on.
  There are many messages available.
</p>
</li>
<li>
<p>
<code>lambda w:self._flip_state(True)</code> is what happens when the message is caught.<br />
  The lambda function accepts the widget instance (<code>w</code>) that GObject sends it and then calls the function <code>self._flip_state(True)</code>.<br />
  Lambda was used to strip the (<code>w</code>) object before calling the <code>self._flip_state</code> function.<br />
  It also allowed use to send <code>self._flip_state()</code> the True state.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_flip_state</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> data<span style="color: #990000">):</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>invert_state<span style="color: #990000">:</span>
                data <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> data
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">change_state</span></span><span style="color: #990000">(</span>data<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This is the function that actually flips the state of the LED.<br />
It is what gets called when the appropriate STATUS message is accepted.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'current-feed-rate'</span><span style="color: #990000">,</span> self<span style="color: #990000">.</span>_set_feedrate_text<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The function called looks like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_set_feedrate_text</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> widget<span style="color: #990000">,</span> data<span style="color: #990000">):</span></tt></pre></div></div>
<div class="paragraph"><p>in which the widget and any data must be accepted by the function.</p></div>
<div class="sect3">
<h4 id="_in_the_em_designer_properties_setter_getters_resetters_em_section">3.3.1. In the <em>Designer Properties Setter/Getters/Resetters</em> Section</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>    <span style="font-style: italic"><span style="color: #9A1900">#########################################################################</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># Qt Designer properties setter/getters/resetters</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">########################################################################</span></span>

    <span style="font-style: italic"><span style="color: #9A1900"># invert status</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">set_invert_state</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> data<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>invert_state <span style="color: #990000">=</span> data
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">get_invert_state</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>invert_state
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">reset_invert_state</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>invert_state <span style="color: #990000">=</span> False

    <span style="font-style: italic"><span style="color: #9A1900"># machine is estopped status</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">set_is_estopped</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> data<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>is_estopped <span style="color: #990000">=</span> data
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">get_is_estopped</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>is_estopped
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">reset_is_estopped</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>is_estopped <span style="color: #990000">=</span> False

    <span style="font-style: italic"><span style="color: #9A1900"># machine is on status</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">set_is_on</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> data<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>is_on <span style="color: #990000">=</span> data
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">get_is_on</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>is_on
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">reset_is_on</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>is_on <span style="color: #990000">=</span> False</tt></pre></div></div>
<div class="paragraph"><p>This is <em>how Qt Designer sets the attributes of the widget</em>.<br />
This <em>can also be called directly</em> in the widget.</p></div>
</div>
<div class="sect3">
<h4 id="_in_the_em_designer_properties_em_section">3.3.2. In the <em>Designer properties</em> section</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>    <span style="font-style: italic"><span style="color: #9A1900">#######################################</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># Qt Designer properties</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">#######################################</span></span>
    invert_state_status <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">pyqtProperty</span></span><span style="color: #990000">(</span>bool<span style="color: #990000">,</span> get_invert_state<span style="color: #990000">,</span> set_invert_state<span style="color: #990000">,</span> reset_invert_state<span style="color: #990000">)</span>
    is_estopped_status <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">pyqtProperty</span></span><span style="color: #990000">(</span>bool<span style="color: #990000">,</span> get_is_estopped<span style="color: #990000">,</span> set_is_estopped<span style="color: #990000">,</span> reset_is_estopped<span style="color: #990000">)</span>
    is_on_status <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">pyqtProperty</span></span><span style="color: #990000">(</span>bool<span style="color: #990000">,</span> get_is_on<span style="color: #990000">,</span> set_is_on<span style="color: #990000">,</span> reset_is_on<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This is the <strong>registering of properties in Qt Designer</strong>.</p></div>
<div class="paragraph"><p>The <strong>property name</strong>:</p></div>
<div class="ulist"><ul>
<li>
<p>
is the <em>text used in Qt Designer</em>,
</p>
</li>
<li>
<p>
<em>cannot be the same as the attributes</em> they represent.
</p>
</li>
</ul></div>
<div class="paragraph"><p>These properties show in Qt Designer in the order they appear here.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_controller_widgets_with_actions">4. Custom Controller Widgets with Actions</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here is an example of a widget that sets the user reference system.</p></div>
<div class="paragraph"><p>It changes:</p></div>
<div class="ulist"><ul>
<li>
<p>
the machine controller state using the <code>ACTION</code> library,
</p>
</li>
<li>
<p>
whether the button can be clicked or not using the <code>STATUS</code> library.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> os
<span style="font-weight: bold"><span style="color: #000080">import</span></span> hal

<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5<span style="color: #990000">.</span>QtWidgets <span style="font-weight: bold"><span style="color: #000080">import</span></span> QWidget<span style="color: #990000">,</span> QToolButton<span style="color: #990000">,</span> QMenu<span style="color: #990000">,</span> QAction
<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5<span style="color: #990000">.</span>QtCore <span style="font-weight: bold"><span style="color: #000080">import</span></span> Qt<span style="color: #990000">,</span> QEvent<span style="color: #990000">,</span> pyqtProperty<span style="color: #990000">,</span> QBasicTimer<span style="color: #990000">,</span> pyqtSignal
<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5<span style="color: #990000">.</span>QtGui <span style="font-weight: bold"><span style="color: #000080">import</span></span> QIcon

<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>widget_baseclass <span style="font-weight: bold"><span style="color: #000080">import</span></span> _HalWidgetBase
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>dialog_widget <span style="font-weight: bold"><span style="color: #000080">import</span></span> EntryDialog
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>core <span style="font-weight: bold"><span style="color: #000080">import</span></span> Status<span style="color: #990000">,</span> Action<span style="color: #990000">,</span> Info

<span style="font-style: italic"><span style="color: #9A1900"># Instantiate the libraries with global reference</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># STATUS gives us status messages from LinuxCNC</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># INFO holds INI details</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># ACTION gives commands to LinuxCNC</span></span>
STATUS <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Status</span></span><span style="color: #990000">()</span>
INFO <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Info</span></span><span style="color: #990000">()</span>
ACTION <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Action</span></span><span style="color: #990000">()</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">SystemToolButton</span></span><span style="color: #990000">(</span>QToolButton<span style="color: #990000">,</span> _HalWidgetBase<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">=</span>None<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000000">super</span></span><span style="color: #990000">(</span>SystemToolButton<span style="color: #990000">,</span> self<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>_joint <span style="color: #990000">=</span> <span style="color: #993399">0</span>
        self<span style="color: #990000">.</span>_last <span style="color: #990000">=</span> <span style="color: #993399">0</span>
        self<span style="color: #990000">.</span>_block_signal <span style="color: #990000">=</span> False
        self<span style="color: #990000">.</span>_auto_label_flag <span style="color: #990000">=</span> True
        SettingMenu <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">QMenu</span></span><span style="color: #990000">()</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> system <span style="font-weight: bold"><span style="color: #0000FF">in</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'G54'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'G55'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'G56'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'G57'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'G58'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'G59'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'G59.1'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'G59.2'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'G59.3'</span><span style="color: #990000">):</span>

            Button <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">QAction</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">QIcon</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'exit24.png'</span><span style="color: #990000">),</span> system<span style="color: #990000">,</span> self<span style="color: #990000">)</span>
            Button<span style="color: #990000">.</span>triggered<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span>self<span style="color: #990000">[</span>system<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">replace</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'.'</span><span style="color: #990000">,</span><span style="color: #FF0000">'_'</span><span style="color: #990000">)])</span>
            SettingMenu<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addAction</span></span><span style="color: #990000">(</span>Button<span style="color: #990000">)</span>

        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setMenu</span></span><span style="color: #990000">(</span>SettingMenu<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>dialog <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">EntryDialog</span></span><span style="color: #990000">()</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_hal_init</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">text</span></span><span style="color: #990000">()</span> <span style="color: #990000">==</span> <span style="color: #FF0000">''</span><span style="color: #990000">:</span>
            self<span style="color: #990000">.</span>_auto_label_flag <span style="color: #990000">=</span> False
        <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">homed_on_test</span></span><span style="color: #990000">():</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span>STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">machine_is_on</span></span><span style="color: #990000">()</span>
                    <span style="font-weight: bold"><span style="color: #0000FF">and</span></span> <span style="color: #990000">(</span>STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">is_all_homed</span></span><span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">or</span></span> INFO<span style="color: #990000">.</span>NO_HOME_REQUIRED<span style="color: #990000">))</span>

        STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-off'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setEnabled</span></span><span style="color: #990000">(</span>False<span style="color: #990000">))</span>
        STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'state-estop'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setEnabled</span></span><span style="color: #990000">(</span>False<span style="color: #990000">))</span>
        STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'interp-idle'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setEnabled</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">homed_on_test</span></span><span style="color: #990000">()))</span>
        STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'interp-run'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setEnabled</span></span><span style="color: #990000">(</span>False<span style="color: #990000">))</span>
        STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'all-homed'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setEnabled</span></span><span style="color: #990000">(</span>True<span style="color: #990000">))</span>
        STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'not-all-homed'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">,</span> data<span style="color: #990000">:</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setEnabled</span></span><span style="color: #990000">(</span>False<span style="color: #990000">))</span>
        STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'interp-paused'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">:</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setEnabled</span></span><span style="color: #990000">(</span>True<span style="color: #990000">))</span>
        STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'user-system-changed'</span><span style="color: #990000">,</span> self<span style="color: #990000">.</span>_set_user_system_text<span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">G54</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        ACTION<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SET_USER_SYSTEM</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'54'</span><span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">G55</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        ACTION<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SET_USER_SYSTEM</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'55'</span><span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">G56</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        ACTION<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SET_USER_SYSTEM</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'56'</span><span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">G57</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        ACTION<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SET_USER_SYSTEM</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'57'</span><span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">G58</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        ACTION<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SET_USER_SYSTEM</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'58'</span><span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">G59</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        ACTION<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SET_USER_SYSTEM</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'59'</span><span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">G59_1</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        ACTION<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SET_USER_SYSTEM</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'59.1'</span><span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">G59_2</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        ACTION<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SET_USER_SYSTEM</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'59.2'</span><span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">G59_3</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        ACTION<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SET_USER_SYSTEM</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'59.3'</span><span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_set_user_system_text</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> w<span style="color: #990000">,</span> data<span style="color: #990000">):</span>
        convert <span style="color: #990000">=</span> <span style="color: #990000">{</span> <span style="color: #993399">1</span><span style="color: #990000">:</span><span style="color: #FF0000">"G54"</span><span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">:</span><span style="color: #FF0000">"G55"</span><span style="color: #990000">,</span> <span style="color: #993399">3</span><span style="color: #990000">:</span><span style="color: #FF0000">"G56"</span><span style="color: #990000">,</span> <span style="color: #993399">4</span><span style="color: #990000">:</span><span style="color: #FF0000">"G57"</span><span style="color: #990000">,</span> <span style="color: #993399">5</span><span style="color: #990000">:</span><span style="color: #FF0000">"G58"</span><span style="color: #990000">,</span> <span style="color: #993399">6</span><span style="color: #990000">:</span><span style="color: #FF0000">"G59"</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">:</span><span style="color: #FF0000">"G59.1"</span><span style="color: #990000">,</span> <span style="color: #993399">8</span><span style="color: #990000">:</span><span style="color: #FF0000">"G59.2"</span><span style="color: #990000">,</span> <span style="color: #993399">9</span><span style="color: #990000">:</span><span style="color: #FF0000">"G59.3"</span><span style="color: #990000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>_auto_label_flag<span style="color: #990000">:</span>
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setText</span></span><span style="color: #990000">(</span>convert<span style="color: #990000">[</span><span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>data<span style="color: #990000">)])</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">ChangeState</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> joint<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>joint<span style="color: #990000">)</span> <span style="color: #990000">!=</span> self<span style="color: #990000">.</span>_joint<span style="color: #990000">:</span>
            self<span style="color: #990000">.</span>_block_signal <span style="color: #990000">=</span> True
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setChecked</span></span><span style="color: #990000">(</span>False<span style="color: #990000">)</span>
            self<span style="color: #990000">.</span>_block_signal <span style="color: #990000">=</span> False
            self<span style="color: #990000">.</span>hal_pin<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set</span></span><span style="color: #990000">(</span>False<span style="color: #990000">)</span>

    <span style="font-style: italic"><span style="color: #9A1900">##############################</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># required class boiler code #</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">##############################</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__getitem__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> item<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">getattr</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> item<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__setitem__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> item<span style="color: #990000">,</span> value<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">setattr</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> item<span style="color: #990000">,</span> value<span style="color: #990000">)</span></tt></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_stylesheet_property_changes_based_on_events">5. Stylesheet Property Changes Based On Events</h2>
<div class="sectionbody">
<div class="paragraph"><p>It&#8217;s possible to <strong>have widgets restyled when events change</strong>.</p></div>
<div class="paragraph"><p>You must explicitly <em>"polish" the widget</em> to have PyQt redo the style.<br />
This is a relatively expensive function so should be used sparingly.</p></div>
<div class="paragraph"><p>This example sets an <code>isHomed</code> property based on LinuxCNC&#8217;s homed state and in turn uses it to change stylesheet properties:</p></div>
<div class="listingblock">
<div class="title">This example will set the property isHomed based on LinuxCNC&#8217;s homed state.</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">HomeLabel</span></span><span style="color: #990000">(</span>QLabel<span style="color: #990000">,</span> _HalWidgetBase<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">=</span>None<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000000">super</span></span><span style="color: #990000">(</span>HomeLabel<span style="color: #990000">,</span> self<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>joint_number <span style="color: #990000">=</span> <span style="color: #993399">0</span>
        <span style="font-style: italic"><span style="color: #9A1900"># for stylesheet reading</span></span>
        self<span style="color: #990000">.</span>_isHomed <span style="color: #990000">=</span> False

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_hal_init</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000000">super</span></span><span style="color: #990000">(</span>HomeLabel<span style="color: #990000">,</span> self<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">_hal_init</span></span><span style="color: #990000">()</span>
        STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'homed'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">,</span>d<span style="color: #990000">:</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_home_status_polish</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>d<span style="color: #990000">),</span> True<span style="color: #990000">))</span>
        STATUS<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'unhomed'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">lambda</span></span> w<span style="color: #990000">,</span>d<span style="color: #990000">:</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_home_status_polish</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>d<span style="color: #990000">),</span> False<span style="color: #990000">))</span>

    <span style="font-style: italic"><span style="color: #9A1900"># update ishomed property</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># polish widget so stylesheet sees the property change</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># some stylesheets color the text on home/unhome</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_home_status_polish</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> d<span style="color: #990000">,</span> state<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>joint_number <span style="color: #990000">=</span> d<span style="color: #990000">:</span>
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'isHomed'</span><span style="color: #990000">,</span> state<span style="color: #990000">)</span>
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">style</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">unpolish</span></span><span style="color: #990000">(</span>self<span style="color: #990000">)</span>
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">style</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">polish</span></span><span style="color: #990000">(</span>self<span style="color: #990000">)</span>

    <span style="font-style: italic"><span style="color: #9A1900"># Qproperty getter and setter</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">getisHomed</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>_isHomed
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">setisHomed</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> data<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span>_isHomed <span style="color: #990000">=</span> data

    <span style="font-style: italic"><span style="color: #9A1900"># Qproperty</span></span>
    isHomed <span style="color: #990000">=</span> QtCore<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">pyqtProperty</span></span><span style="color: #990000">(</span>bool<span style="color: #990000">,</span> getisHomed<span style="color: #990000">,</span> setisHomed<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Here is a sample stylesheet to change text color based on home state.</p></div>
<div class="paragraph"><p>In this case any widget based on the HomeLabel widget above will change text color.<br />
You would usually pick specific widgets using <code>HomeLabel #specific_widget_name[homed=true]</code>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>HomeLabel[homed=true] {
    color: green;
}
HomeLabel[homed=false] {
    color: red;
}</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_use_stylesheets_to_change_custom_widget_properties">6. Use Stylesheets To Change Custom Widget Properties</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">Label</span></span><span style="color: #990000">(</span>QLabel<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">=</span>None<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000000">super</span></span><span style="color: #990000">(</span>Label<span style="color: #990000">,</span> self<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>
        alternateFont0 <span style="color: #990000">=</span> self<span style="color: #990000">.</span>font

    <span style="font-style: italic"><span style="color: #9A1900"># Qproperty getter and setter</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">getFont0</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>aleternateFont0
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">setFont0</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> value<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">alternateFont0</span></span><span style="color: #990000">(</span>value<span style="color: #990000">)</span>
    <span style="font-style: italic"><span style="color: #9A1900"># Qproperty</span></span>
    styleFont0 <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">pyqtProperty</span></span><span style="color: #990000">(</span>QFont<span style="color: #990000">,</span> getFont0<span style="color: #990000">,</span> setFont0<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Sample stylesheet that sets a custom widget property.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Label{
    qproperty-styleFont0: "Times,12,-1,0,90,0,0,0,0,0";
}</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_widget_plugins">7. Widget Plugins</h2>
<div class="sectionbody">
<div class="paragraph"><p>We must <em>register our custom widget</em> for Qt Designer to use them.<br /></p></div>
<div class="paragraph"><p>Here are a typical samples.<br />
They would need to be added to <code>qtvcp/plugins/</code><br />
Then <code>qtvcp/plugins/qtvcp_plugin.py</code> would need to be adjusted to <em>import</em> them.</p></div>
<div class="sect2">
<h3 id="_gridlayout_example">7.1. Gridlayout Example</h3>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/env python3</span></span>

<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5 <span style="font-weight: bold"><span style="color: #000080">import</span></span> QtCore<span style="color: #990000">,</span> QtGui
<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5<span style="color: #990000">.</span>QtDesigner <span style="font-weight: bold"><span style="color: #000080">import</span></span> QPyDesignerCustomWidgetPlugin
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>simple_widgets <span style="font-weight: bold"><span style="color: #000080">import</span></span> Lcnc_GridLayout
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>qtvcp_icons <span style="font-weight: bold"><span style="color: #000080">import</span></span> Icon
ICON <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Icon</span></span><span style="color: #990000">()</span>

<span style="font-style: italic"><span style="color: #9A1900">####################################</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># GridLayout</span></span>
<span style="font-style: italic"><span style="color: #9A1900">####################################</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">LcncGridLayoutPlugin</span></span><span style="color: #990000">(</span>QPyDesignerCustomWidgetPlugin<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent <span style="color: #990000">=</span> None<span style="color: #990000">):</span>
        QPyDesignerCustomWidgetPlugin<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>initialized <span style="color: #990000">=</span> False
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">initialize</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> formEditor<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>initialized<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>
        self<span style="color: #990000">.</span>initialized <span style="color: #990000">=</span> True
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">isInitialized</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>initialized
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">createWidget</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">Lcnc_GridLayout</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">name</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"Lcnc_GridLayout"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">group</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"LinuxCNC - HAL"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">icon</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> QtGui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QIcon</span></span><span style="color: #990000">(</span>QtGui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QPixmap</span></span><span style="color: #990000">(</span>ICON<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_path</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'lcnc_gridlayout'</span><span style="color: #990000">)))</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">toolTip</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"HAL enable/disable GridLayout widget"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">whatsThis</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">""</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">isContainer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> True
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">domXml</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">'&lt;widget class="Lcnc_GridLayout" name="lcnc_gridlayout" /&gt;\n'</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">includeFile</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"qtvcp.widgets.simple_widgets"</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_systemtoolbutton_example">7.2. SystemToolbutton Example</h3>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/env python3</span></span>

<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5 <span style="font-weight: bold"><span style="color: #000080">import</span></span> QtCore<span style="color: #990000">,</span> QtGui
<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5<span style="color: #990000">.</span>QtDesigner <span style="font-weight: bold"><span style="color: #000080">import</span></span> QPyDesignerCustomWidgetPlugin
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>system_tool_button <span style="font-weight: bold"><span style="color: #000080">import</span></span> SystemToolButton
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>qtvcp_icons <span style="font-weight: bold"><span style="color: #000080">import</span></span> Icon
ICON <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Icon</span></span><span style="color: #990000">()</span>

<span style="font-style: italic"><span style="color: #9A1900">####################################</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># SystemToolButton</span></span>
<span style="font-style: italic"><span style="color: #9A1900">####################################</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">SystemToolButtonPlugin</span></span><span style="color: #990000">(</span>QPyDesignerCustomWidgetPlugin<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent <span style="color: #990000">=</span> None<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000000">super</span></span><span style="color: #990000">(</span>SystemToolButtonPlugin<span style="color: #990000">,</span> self<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>initialized <span style="color: #990000">=</span> False
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">initialize</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> formEditor<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>initialized<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>
        self<span style="color: #990000">.</span>initialized <span style="color: #990000">=</span> True
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">isInitialized</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>initialized
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">createWidget</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">SystemToolButton</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">name</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"SystemToolButton"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">group</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"LinuxCNC - Controller"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">icon</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> QtGui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QIcon</span></span><span style="color: #990000">(</span>QtGui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QPixmap</span></span><span style="color: #990000">(</span>ICON<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_path</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'systemtoolbutton'</span><span style="color: #990000">)))</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">toolTip</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"Button for selecting a User Coordinate System"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">whatsThis</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">""</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">isContainer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> False
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">domXml</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">'&lt;widget class="SystemToolButton" name="systemtoolbutton" /&gt;\n'</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">includeFile</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"qtvcp.widgets.system_tool_button"</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_making_a_plugin_with_a_menuentry_dialog_box">7.3. Making a plugin with a MenuEntry dialog box</h3>
<div class="paragraph"><p>It possible to add an entry to the dialog that pops up when you right click the widget in the layout.</p></div>
<div class="paragraph"><p>This can do things such as selecting options in a more convenient way.</p></div>
<div class="paragraph"><p>This is the plugin used for <em>action buttons</em>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/usr/bin/env python3</span></span>

<span style="font-weight: bold"><span style="color: #000080">import</span></span> sip
<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5 <span style="font-weight: bold"><span style="color: #000080">import</span></span> QtCore<span style="color: #990000">,</span> QtGui<span style="color: #990000">,</span> QtWidgets
<span style="font-weight: bold"><span style="color: #000080">from</span></span> PyQt5<span style="color: #990000">.</span>QtDesigner <span style="font-weight: bold"><span style="color: #000080">import</span></span> QPyDesignerCustomWidgetPlugin<span style="color: #990000">,</span> <span style="color: #990000">\</span>
                QPyDesignerTaskMenuExtension<span style="color: #990000">,</span> QExtensionFactory<span style="color: #990000">,</span> <span style="color: #990000">\</span>
                QDesignerFormWindowInterface<span style="color: #990000">,</span> QPyDesignerMemberSheetExtension
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>action_button <span style="font-weight: bold"><span style="color: #000080">import</span></span> ActionButton
<span style="font-weight: bold"><span style="color: #000080">from</span></span> qtvcp<span style="color: #990000">.</span>widgets<span style="color: #990000">.</span>qtvcp_icons <span style="font-weight: bold"><span style="color: #000080">import</span></span> Icon
ICON <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Icon</span></span><span style="color: #990000">()</span>

Q_TYPEID <span style="color: #990000">=</span> <span style="color: #990000">{</span>
    <span style="color: #FF0000">'QDesignerContainerExtension'</span><span style="color: #990000">:</span>     <span style="color: #FF0000">'org.qt-project.Qt.Designer.Container'</span><span style="color: #990000">,</span>
    <span style="color: #FF0000">'QDesignerPropertySheetExtension'</span><span style="color: #990000">:</span> <span style="color: #FF0000">'org.qt-project.Qt.Designer.PropertySheet'</span><span style="color: #990000">,</span>
    <span style="color: #FF0000">'QDesignerTaskMenuExtension'</span><span style="color: #990000">:</span> <span style="color: #FF0000">'org.qt-project.Qt.Designer.TaskMenu'</span><span style="color: #990000">,</span>
    <span style="color: #FF0000">'QDesignerMemberSheetExtension'</span><span style="color: #990000">:</span> <span style="color: #FF0000">'org.qt-project.Qt.Designer.MemberSheet'</span>
<span style="color: #990000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">####################################</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># ActionBUTTON</span></span>
<span style="font-style: italic"><span style="color: #9A1900">####################################</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">ActionButtonPlugin</span></span><span style="color: #990000">(</span>QPyDesignerCustomWidgetPlugin<span style="color: #990000">):</span>

    <span style="font-style: italic"><span style="color: #9A1900"># The __init__() method is only used to set up the plugin and define its</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># initialized variable.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">=</span>None<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000000">super</span></span><span style="color: #990000">(</span>ActionButtonPlugin<span style="color: #990000">,</span> self<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>initialized <span style="color: #990000">=</span> False

    <span style="font-style: italic"><span style="color: #9A1900"># The initialize() and isInitialized() methods allow the plugin to set up</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># any required resources, ensuring that this can only happen once for each</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># plugin.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">initialize</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> formEditor<span style="color: #990000">):</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>initialized<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span>
        manager <span style="color: #990000">=</span> formEditor<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">extensionManager</span></span><span style="color: #990000">()</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> manager<span style="color: #990000">:</span>
            self<span style="color: #990000">.</span>factory <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">ActionButtonTaskMenuFactory</span></span><span style="color: #990000">(</span>manager<span style="color: #990000">)</span>
            manager<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">registerExtensions</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>factory<span style="color: #990000">,</span> Q_TYPEID<span style="color: #990000">[</span><span style="color: #FF0000">'QDesignerTaskMenuExtension'</span><span style="color: #990000">])</span>
        self<span style="color: #990000">.</span>initialized <span style="color: #990000">=</span> True

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">isInitialized</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>initialized

    <span style="font-style: italic"><span style="color: #9A1900"># This factory method creates new instances of our custom widget</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">createWidget</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">ActionButton</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>

    <span style="font-style: italic"><span style="color: #9A1900"># This method returns the name of the custom widget class</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">name</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"ActionButton"</span>

    <span style="font-style: italic"><span style="color: #9A1900"># Returns the name of the group in Qt Designer's widget box</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">group</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"LinuxCNC - Controller"</span>

    <span style="font-style: italic"><span style="color: #9A1900"># Returns the icon</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">icon</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> QtGui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QIcon</span></span><span style="color: #990000">(</span>QtGui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QPixmap</span></span><span style="color: #990000">(</span>ICON<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_path</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'actionbutton'</span><span style="color: #990000">)))</span>

    <span style="font-style: italic"><span style="color: #9A1900"># Returns a tool tip short description</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">toolTip</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"Action button widget"</span>

    <span style="font-style: italic"><span style="color: #9A1900"># Returns a short description of the custom widget for use in a "What's</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># This?" help message for the widget.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">whatsThis</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">""</span>

    <span style="font-style: italic"><span style="color: #9A1900"># Returns True if the custom widget acts as a container for other widgets;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">isContainer</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> False

    <span style="font-style: italic"><span style="color: #9A1900"># Returns an XML description of a custom widget instance that describes</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># default values for its properties.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">domXml</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">'&lt;widget class="ActionButton" name="actionbutton" /&gt;\n'</span>

    <span style="font-style: italic"><span style="color: #9A1900"># Returns the module containing the custom widget class. It may include</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># a module path.</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">includeFile</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"qtvcp.widgets.action_button"</span>


<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">ActionButtonDialog</span></span><span style="color: #990000">(</span>QtWidgets<span style="color: #990000">.</span>QDialog<span style="color: #990000">):</span>

   <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> widget<span style="color: #990000">,</span> parent <span style="color: #990000">=</span> None<span style="color: #990000">):</span>

      QtWidgets<span style="color: #990000">.</span>QDialog<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">)</span>

      self<span style="color: #990000">.</span>widget <span style="color: #990000">=</span> widget

      self<span style="color: #990000">.</span>previewWidget <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">ActionButton</span></span><span style="color: #990000">()</span>

      buttonBox <span style="color: #990000">=</span> QtWidgets<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QDialogButtonBox</span></span><span style="color: #990000">()</span>
      okButton <span style="color: #990000">=</span> buttonBox<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addButton</span></span><span style="color: #990000">(</span>buttonBox<span style="color: #990000">.</span>Ok<span style="color: #990000">)</span>
      cancelButton <span style="color: #990000">=</span> buttonBox<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addButton</span></span><span style="color: #990000">(</span>buttonBox<span style="color: #990000">.</span>Cancel<span style="color: #990000">)</span>

      okButton<span style="color: #990000">.</span>clicked<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>updateWidget<span style="color: #990000">)</span>
      cancelButton<span style="color: #990000">.</span>clicked<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>reject<span style="color: #990000">)</span>

      layout <span style="color: #990000">=</span> QtWidgets<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QGridLayout</span></span><span style="color: #990000">()</span>
      self<span style="color: #990000">.</span>c_estop <span style="color: #990000">=</span> QtWidgets<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QCheckBox</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Estop Action"</span><span style="color: #990000">)</span>
      self<span style="color: #990000">.</span>c_estop<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setChecked</span></span><span style="color: #990000">(</span>widget<span style="color: #990000">.</span>estop <span style="color: #990000">)</span>
      layout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addWidget</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>c_estop<span style="color: #990000">)</span>

      layout<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addWidget</span></span><span style="color: #990000">(</span>buttonBox<span style="color: #990000">,</span> <span style="color: #993399">5</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #993399">2</span><span style="color: #990000">)</span>
      self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setLayout</span></span><span style="color: #990000">(</span>layout<span style="color: #990000">)</span>

      self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setWindowTitle</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">tr</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Set Options"</span><span style="color: #990000">))</span>

   <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">updateWidget</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>

      formWindow <span style="color: #990000">=</span> QDesignerFormWindowInterface<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">findFormWindow</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>widget<span style="color: #990000">)</span>
      <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> formWindow<span style="color: #990000">:</span>
          formWindow<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">cursor</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"estop_action"</span><span style="color: #990000">,</span>
              QtCore<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QVariant</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>c_estop<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">isChecked</span></span><span style="color: #990000">()))</span>
      self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">accept</span></span><span style="color: #990000">()</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">ActionButtonMenuEntry</span></span><span style="color: #990000">(</span>QPyDesignerTaskMenuExtension<span style="color: #990000">):</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> widget<span style="color: #990000">,</span> parent<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000000">super</span></span><span style="color: #990000">(</span>QPyDesignerTaskMenuExtension<span style="color: #990000">,</span> self<span style="color: #990000">).</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>widget <span style="color: #990000">=</span> widget
        self<span style="color: #990000">.</span>editStateAction <span style="color: #990000">=</span> QtWidgets<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">QAction</span></span><span style="color: #990000">(</span>
          self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">tr</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Set Options..."</span><span style="color: #990000">),</span> self<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>editStateAction<span style="color: #990000">.</span>triggered<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>updateOptions<span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">preferredEditAction</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> self<span style="color: #990000">.</span>editStateAction

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">taskActions</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">[</span>self<span style="color: #990000">.</span>editStateAction<span style="color: #990000">]</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">updateOptions</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        dialog <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">ActionButtonDialog</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>widget<span style="color: #990000">)</span>
        dialog<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exec_</span></span><span style="color: #990000">()</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">ActionButtonTaskMenuFactory</span></span><span style="color: #990000">(</span>QExtensionFactory<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent <span style="color: #990000">=</span> None<span style="color: #990000">):</span>
        QExtensionFactory<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> parent<span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">createExtension</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> obj<span style="color: #990000">,</span> iid<span style="color: #990000">,</span> parent<span style="color: #990000">):</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> <span style="font-weight: bold"><span style="color: #000000">isinstance</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">,</span> ActionButton<span style="color: #990000">):</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> None
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> iid <span style="color: #990000">==</span> Q_TYPEID<span style="color: #990000">[</span><span style="color: #FF0000">'QDesignerTaskMenuExtension'</span><span style="color: #990000">]:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">ActionButtonMenuEntry</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">,</span> parent<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">elif</span></span> iid <span style="color: #990000">==</span> Q_TYPEID<span style="color: #990000">[</span><span style="color: #FF0000">'QDesignerMemberSheetExtension'</span><span style="color: #990000">]:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">ActionButtonMemberSheet</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">,</span> parent<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> None</tt></pre></div></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2023-02-15 15:40:19 CET
</div>
</div>
</body>
</html>
