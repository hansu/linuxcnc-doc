<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 9.0.0rc2" />
<title>PyVCP Examples</title>
<link rel="stylesheet" href="..//asciidoc.css" type="text/css" />


<link rel="stylesheet" href="..//linuxcnc.css" type="text/css" />
<script type="text/javascript" src="..//asciidoc.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
<h1>PyVCP Examples</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_axis">1. AXIS</h2>
<div class="sectionbody">
<div class="paragraph"><p>To create a PyVCP panel to use with the AXIS interface that is
attached to the right of AXIS you need to do the following basic
things.</p></div>
<div class="ulist"><ul>
<li>
<p>
Create an XML file that contains your panel description and put it in
  your config directory.
</p>
</li>
<li>
<p>
Add the PyVCP entry to the [DISPLAY] section of the INI file with your XML file name.
</p>
</li>
<li>
<p>
Add the POSTGUI_HALFILE entry to the [HAL] section of the INI file
  with the name of your postgui HAL file name.
</p>
</li>
<li>
<p>
Add the links to HAL pins for your panel in the postgui.hal file to
  <em>connect</em> your PyVCP panel to LinuxCNC.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_floating_panels">2. Floating Panels</h2>
<div class="sectionbody">
<div class="paragraph"><p>To create floating PyVCP panels that can be used with any interface
you need to do the following basic things.</p></div>
<div class="ulist"><ul>
<li>
<p>
Create an XML file that contains your panel description and put it in
  your config directory.
</p>
</li>
<li>
<p>
Add a loadusr line to your HAL file to load each panel.
</p>
</li>
<li>
<p>
Add the links to HAL pins for your panel in the postgui.hal file to
  <em>connect</em> your PyVCP panel to LinuxCNC.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The following is an example of a loadusr command to load two PyVCP
panels and name each one so the connection names in HAL will be known.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>loadusr <span style="color: #990000">-</span>Wn <span style="color: #008080">btnpanel</span> pyvcp <span style="color: #990000">-</span>c <span style="color: #008080">btnpanel</span> panel1<span style="color: #990000">.</span>xml
loadusr <span style="color: #990000">-</span>Wn <span style="color: #008080">sppanel</span> pyvcp <span style="color: #990000">-</span>c <span style="color: #008080">sppanel</span> panel2<span style="color: #990000">.</span>xml</tt></pre></div></div>
<div class="paragraph"><p>The -Wn makes HAL <em>Wait for name</em> to be loaded before proceeding.</p></div>
<div class="paragraph"><p>The pyvcp -c makes PyVCP name the panel.</p></div>
<div class="paragraph"><p>The HAL pins from panel1.xml will be named btnpanel.&lt;_pin name_&gt;.</p></div>
<div class="paragraph"><p>The HAL pins from panel2.xml will be named sppanel.&lt;_pin name_&gt;.</p></div>
<div class="paragraph"><p>Make sure the loadusr line is before any nets that make use of the
PyVCP pins.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_jog_buttons_example">3. Jog Buttons Example</h2>
<div class="sectionbody">
<div class="paragraph"><p>In this example we will create a PyVCP panel with jog buttons for X, Y, and Z.
This configuration will be built upon a Stepconf Wizard
generated configuration. First we run the Stepconf Wizard and configure
our machine, then on the Advanced Configuration Options page we make a
couple of selections to add a blank PyVCP panel as shown in the
following figure. For this example we named the configuration
<em>pyvcp_xyz</em> on the Basic Machine Information page of the Stepconf
Wizard.</p></div>
<div class="imageblock" id="cap:XYZ-Wizard-Configuration">
<div class="content">
<figure>
<img src="images/xyz_ACO.png" alt="PyVCP XYZ Wizard Configuration"/>
<figcaption class="title"> Figure 1. XYZ Wizard Configuration</figcaption>
</figure>
</div>
</div>
<div class="paragraph"><p>The Stepconf Wizard will create several files and place them in the
linuxcnc/configs/pyvcp_xyz directory. If you left the create link checked
you will have a link to those files on your desktop.</p></div>
<div class="sect2">
<h3 id="_create_the_widgets">3.1. Create the Widgets</h3>
<div class="paragraph"><p>Open up the custompanel.xml file by right clicking on it and selecting
<em>open with text editor</em>. Between the &lt;pyvcp&gt;&lt;/pyvcp&gt; tags we will add
the widgets for our panel.</p></div>
<div class="paragraph"><p>Look in the PyVCP Widgets Reference section of the manual for more
detailed information on each widget <a href="pyvcp.html#sec:pyvcp:widgets">documentation des widgets</a>.</p></div>
<div class="paragraph"><p>In your custompanel.xml file we will add the description of the
widgets.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>&lt;pyvcp&gt;
  &lt;labelframe text="Jog Buttons"&gt;
    &lt;font&gt;("Helvetica",16)&lt;/font&gt;

      &lt;!-- the X jog buttons --&gt;
      &lt;hbox&gt;
      &lt;relief&gt;RAISED&lt;/relief&gt;
      &lt;bd&gt;3&lt;/bd&gt;
      &lt;button&gt;
        &lt;font&gt;("Helvetica",20)&lt;/font&gt;
        &lt;width&gt;3&lt;/width&gt;
        &lt;halpin&gt;"x-plus"&lt;/halpin&gt;
        &lt;text&gt;"X+"&lt;/text&gt;
      &lt;/button&gt;
      &lt;button&gt;
        &lt;font&gt;("Helvetica",20)&lt;/font&gt;
        &lt;width&gt;3&lt;/width&gt;
        &lt;halpin&gt;"x-minus"&lt;/halpin&gt;
        &lt;text&gt;"X-"&lt;/text&gt;
      &lt;/button&gt;
      &lt;/hbox&gt;

      &lt;!-- the Y jog buttons --&gt;
      &lt;hbox&gt;
      &lt;relief&gt;RAISED&lt;/relief&gt;
      &lt;bd&gt;3&lt;/bd&gt;
      &lt;button&gt;
        &lt;font&gt;("Helvetica",20)&lt;/font&gt;
        &lt;width&gt;3&lt;/width&gt;
        &lt;halpin&gt;"y-plus"&lt;/halpin&gt;
        &lt;text&gt;"Y+"&lt;/text&gt;
      &lt;/button&gt;
      &lt;button&gt;
        &lt;font&gt;("Helvetica",20)&lt;/font&gt;
        &lt;width&gt;3&lt;/width&gt;
        &lt;halpin&gt;"y-minus"&lt;/halpin&gt;
        &lt;text&gt;"Y-"&lt;/text&gt;
      &lt;/button&gt;
      &lt;/hbox&gt;

      &lt;!-- the Z jog buttons --&gt;
      &lt;hbox&gt;
      &lt;relief&gt;RAISED&lt;/relief&gt;
      &lt;bd&gt;3&lt;/bd&gt;
      &lt;button&gt;
        &lt;font&gt;("Helvetica",20)&lt;/font&gt;
        &lt;width&gt;3&lt;/width&gt;
        &lt;halpin&gt;"z-plus"&lt;/halpin&gt;
        &lt;text&gt;"Z+"&lt;/text&gt;
      &lt;/button&gt;
      &lt;button&gt;
        &lt;font&gt;("Helvetica",20)&lt;/font&gt;
        &lt;width&gt;3&lt;/width&gt;
        &lt;halpin&gt;"z-minus"&lt;/halpin&gt;
        &lt;text&gt;"Z-"&lt;/text&gt;
      &lt;/button&gt;
      &lt;/hbox&gt;

      &lt;!-- the jog speed slider --&gt;
      &lt;vbox&gt;
      &lt;relief&gt;RAISED&lt;/relief&gt;
      &lt;bd&gt;3&lt;/bd&gt;
      &lt;label&gt;
        &lt;text&gt;"Jog Speed"&lt;/text&gt;
        &lt;font&gt;("Helvetica",16)&lt;/font&gt;
      &lt;/label&gt;
      &lt;scale&gt;
        &lt;font&gt;("Helvetica",14)&lt;/font&gt;
        &lt;halpin&gt;"jog-speed"&lt;/halpin&gt;
        &lt;resolution&gt;1&lt;/resolution&gt;
        &lt;orient&gt;HORIZONTAL&lt;/orient&gt;
        &lt;min_&gt;0&lt;/min_&gt;
        &lt;max_&gt;80&lt;/max_&gt;
      &lt;/scale&gt;
      &lt;/vbox&gt;
  &lt;/labelframe&gt;
&lt;/pyvcp&gt;</code></pre>
</div></div>
<div class="paragraph"><p>After adding the above you now will have a PyVCP panel that looks like
the following attached to the right side of AXIS. It looks nice but it
does not do anything until you <em>connect</em> the buttons to halui. If you
get an error when you try and run scroll down to the bottom of the pop
up window and usually the error is a spelling or syntax error and it
will be there.</p></div>
<div class="imageblock">
<div class="content">
<figure>
<img src="images/xyz_buttons.png" alt="Jog Buttons Image"/>
</figure>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_make_connections">3.2. Make Connections</h3>
<div class="paragraph"><p>To make the connections needed open up your custom_postgui.hal file
and add the following.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># connect the X PyVCP buttons</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">my-jogxminus</span></span> <span style="color: #009900">halui.axis.x.minus</span> <span style="color: #990000">&lt;=</span> <span style="color: #009900">pyvcp.x-minus</span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">my-jogxplus</span></span> <span style="color: #009900">halui.axis.x.plus</span> <span style="color: #990000">&lt;=</span> <span style="color: #009900">pyvcp.x-plus</span>

<span style="font-style: italic"><span style="color: #9A1900"># connect the Y PyVCP buttons</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">my-jogyminus</span></span> <span style="color: #009900">halui.axis.y.minus</span> <span style="color: #990000">&lt;=</span> <span style="color: #009900">pyvcp.y-minus</span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">my-jogyplus</span></span> <span style="color: #009900">halui.axis.y.plus</span> <span style="color: #990000">&lt;=</span> <span style="color: #009900">pyvcp.y-plus</span>

<span style="font-style: italic"><span style="color: #9A1900"># connect the Z PyVCP buttons</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">my-jogzminus</span></span> <span style="color: #009900">halui.axis.z.minus</span> <span style="color: #990000">&lt;=</span> <span style="color: #009900">pyvcp.z-minus</span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">my-jogzplus</span></span> <span style="color: #009900">halui.axis.z.plus</span> <span style="color: #990000">&lt;=</span> <span style="color: #009900">pyvcp.z-plus</span>

<span style="font-style: italic"><span style="color: #9A1900"># connect the PyVCP jog speed slider</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">my-jogspeed</span></span> <span style="color: #009900">halui.axis.jog-speed</span> <span style="color: #990000">&lt;=</span> <span style="color: #009900">pyvcp.jog-speed-f</span></tt></pre></div></div>
<div class="paragraph"><p>After resetting the E-Stop and putting it into jog mode and moving the
jog speed slider in the PyVCP panel to a value greater than zero the
PyVCP jog buttons should work. You can not jog when running a G-code
file or while paused or while the MDI tab is selected.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_port_tester">4. Port Tester</h2>
<div class="sectionbody">
<div class="paragraph"><p>This example shows you how to make a simple parallel port tester using
PyVCP and HAL.</p></div>
<div class="paragraph"><p>First create the ptest.xml file with the following code to create the
panel description.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>&lt;!-- Test panel for the parallel port cfg for out --&gt;
&lt;pyvcp&gt;
  &lt;hbox&gt;
    &lt;relief&gt;RIDGE&lt;/relief&gt;
    &lt;bd&gt;2&lt;/bd&gt;
    &lt;button&gt;
      &lt;halpin&gt;"btn01"&lt;/halpin&gt;
      &lt;text&gt;"Pin 01"&lt;/text&gt;
    &lt;/button&gt;
    &lt;led&gt;
      &lt;halpin&gt;"led-01"&lt;/halpin&gt;
      &lt;size&gt;25&lt;/size&gt;
      &lt;on_color&gt;"green"&lt;/on_color&gt;
      &lt;off_color&gt;"red"&lt;/off_color&gt;
    &lt;/led&gt;
  &lt;/hbox&gt;
  &lt;hbox&gt;
    &lt;relief&gt;RIDGE&lt;/relief&gt;
    &lt;bd&gt;2&lt;/bd&gt;
    &lt;button&gt;
      &lt;halpin&gt;"btn02"&lt;/halpin&gt;
      &lt;text&gt;"Pin 02"&lt;/text&gt;
    &lt;/button&gt;
    &lt;led&gt;
      &lt;halpin&gt;"led-02"&lt;/halpin&gt;
      &lt;size&gt;25&lt;/size&gt;
      &lt;on_color&gt;"green"&lt;/on_color&gt;
      &lt;off_color&gt;"red"&lt;/off_color&gt;
    &lt;/led&gt;
  &lt;/hbox&gt;
  &lt;hbox&gt;
    &lt;relief&gt;RIDGE&lt;/relief&gt;
    &lt;bd&gt;2&lt;/bd&gt;
    &lt;label&gt;
      &lt;text&gt;"Pin 10"&lt;/text&gt;
      &lt;font&gt;("Helvetica",14)&lt;/font&gt;
    &lt;/label&gt;
    &lt;led&gt;
      &lt;halpin&gt;"led-10"&lt;/halpin&gt;
      &lt;size&gt;25&lt;/size&gt;
      &lt;on_color&gt;"green"&lt;/on_color&gt;
      &lt;off_color&gt;"red"&lt;/off_color&gt;
    &lt;/led&gt;
  &lt;/hbox&gt;
  &lt;hbox&gt;
    &lt;relief&gt;RIDGE&lt;/relief&gt;
    &lt;bd&gt;2&lt;/bd&gt;
    &lt;label&gt;
      &lt;text&gt;"Pin 11"&lt;/text&gt;
      &lt;font&gt;("Helvetica",14)&lt;/font&gt;
    &lt;/label&gt;
    &lt;led&gt;
      &lt;halpin&gt;"led-11"&lt;/halpin&gt;
      &lt;size&gt;25&lt;/size&gt;
      &lt;on_color&gt;"green"&lt;/on_color&gt;
      &lt;off_color&gt;"red"&lt;/off_color&gt;
    &lt;/led&gt;
  &lt;/hbox&gt;
&lt;/pyvcp&gt;</code></pre>
</div></div>
<div class="paragraph"><p>This will create the following floating panel which contains a couple
of in pins and a couple of out pins.</p></div>
<div class="imageblock">
<div class="content">
<figure>
<img src="images/ptest.png" alt="Port Tester Panel"/>
</figure>
</div>
</div>
<div class="paragraph"><p>To run the HAL commands that we need to get everything up and running
we put the following in our ptest.hal file.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">loadrt</span> <span style="color: #008080">hal_parport</span> cfg<span style="color: #990000">=</span><span style="color: #FF0000">"0x378 out"</span>
loadusr <span style="color: #990000">-</span>Wn <span style="color: #008080">ptest</span> pyvcp <span style="color: #990000">-</span>c <span style="color: #008080">ptest</span> ptest<span style="color: #990000">.</span>xml
loadrt <span style="color: #008080">threads</span> name1<span style="color: #990000">=</span><span style="color: #008080">porttest</span> period1<span style="color: #990000">=</span><span style="color: #993399">1000000</span>
<span style="color: #008080">addf</span> parport<span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">.</span>read porttest
<span style="color: #008080">addf</span> parport<span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">.</span>write porttest
net <span style="color: #008080">pin01</span> ptest<span style="color: #990000">.</span><span style="color: #008080">btn01</span> parport<span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">.</span>pin<span style="color: #990000">-</span><span style="color: #993399">01</span><span style="color: #990000">-</span><span style="color: #008080">out</span> ptest<span style="color: #990000">.</span>led<span style="color: #990000">-</span><span style="color: #993399">01</span>
net <span style="color: #008080">pin02</span> ptest<span style="color: #990000">.</span><span style="color: #008080">btn02</span> parport<span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">.</span>pin<span style="color: #990000">-</span><span style="color: #993399">02</span><span style="color: #990000">-</span><span style="color: #008080">out</span> ptest<span style="color: #990000">.</span>led<span style="color: #990000">-</span><span style="color: #993399">02</span>
net <span style="color: #008080">pin10</span> parport<span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">.</span>pin<span style="color: #990000">-</span><span style="color: #993399">10</span><span style="color: #990000">-</span><span style="color: #008080">in</span> ptest<span style="color: #990000">.</span>led<span style="color: #990000">-</span><span style="color: #993399">10</span>
net <span style="color: #008080">pin11</span> parport<span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">.</span>pin<span style="color: #990000">-</span><span style="color: #993399">11</span><span style="color: #990000">-</span><span style="color: #008080">in</span> ptest<span style="color: #990000">.</span>led<span style="color: #990000">-</span><span style="color: #993399">11</span>
start</tt></pre></div></div>
<div class="paragraph"><p>To run the HAL file we use the following command from a terminal window.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>~$ halrun -I -f ptest.hal</code></pre>
</div></div>
<div class="paragraph"><p>The following figure shows what a complete panel might look like.</p></div>
<div class="imageblock">
<div class="content">
<figure>
<img src="images/ptest-final.png" alt="Port Tester Complete Image"/>
</figure>
</div>
</div>
<div class="paragraph"><p>To add the rest of the parallel port pins just modify the XML and HAL files.</p></div>
<div class="paragraph"><p>To show the pins after running the HAL script use the following
command at the halcmd prompt:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>halcmd: show pin
Component Pins:
Owner Type  Dir Value  Name
    2 bit   IN  FALSE  parport.0.pin-01-out &lt;== pin01
    2 bit   IN  FALSE  parport.0.pin-02-out &lt;== pin02
    2 bit   IN  FALSE  parport.0.pin-03-out
    2 bit   IN  FALSE  parport.0.pin-04-out
    2 bit   IN  FALSE  parport.0.pin-05-out
    2 bit   IN  FALSE  parport.0.pin-06-out
    2 bit   IN  FALSE  parport.0.pin-07-out
    2 bit   IN  FALSE  parport.0.pin-08-out
    2 bit   IN  FALSE  parport.0.pin-09-out
    2 bit   OUT TRUE   parport.0.pin-10-in ==&gt; pin10
    2 bit   OUT FALSE  parport.0.pin-10-in-not
    2 bit   OUT TRUE   parport.0.pin-11-in ==&gt; pin11
    2 bit   OUT FALSE  parport.0.pin-11-in-not
    2 bit   OUT TRUE   parport.0.pin-12-in
    2 bit   OUT FALSE  parport.0.pin-12-in-not
    2 bit   OUT TRUE   parport.0.pin-13-in
    2 bit   OUT FALSE  parport.0.pin-13-in-not
    2 bit   IN  FALSE  parport.0.pin-14-out
    2 bit   OUT TRUE   parport.0.pin-15-in
    2 bit   OUT FALSE  parport.0.pin-15-in-not
    2 bit   IN  FALSE  parport.0.pin-16-out
    2 bit   IN  FALSE  parport.0.pin-17-out
    4 bit   OUT FALSE  ptest.btn01 ==&gt; pin01
    4 bit   OUT FALSE  ptest.btn02 ==&gt; pin02
    4 bit   IN  FALSE  ptest.led-01 &lt;== pin01
    4 bit   IN  FALSE  ptest.led-02 &lt;== pin02
    4 bit   IN  TRUE   ptest.led-10 &lt;== pin10
    4 bit   IN  TRUE   ptest.led-11 &lt;== pin11</code></pre>
</div></div>
<div class="paragraph"><p>This will show you what pins are IN and what pins are OUT as well as
any connections.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="gs2-rpm-meter">5. GS2 RPM Meter</h2>
<div class="sectionbody">
<div class="paragraph"><p>The following example uses the Automation Direct GS2 VDF driver and
displays the RPM and other info in a PyVCP panel. This example is based
on the GS2 example in the Hardware Examples section this manual.</p></div>
<div class="sect2">
<h3 id="_the_panel">5.1. The Panel</h3>
<div class="paragraph"><p>To create the panel we add the following to the XML file.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>&lt;pyvcp&gt;

  &lt;!-- the RPM meter --&gt;
  &lt;hbox&gt;
    &lt;relief&gt;RAISED&lt;/relief&gt;
    &lt;bd&gt;3&lt;/bd&gt;
    &lt;meter&gt;
      &lt;halpin&gt;"spindle_rpm"&lt;/halpin&gt;
      &lt;text&gt;"Spindle"&lt;/text&gt;
      &lt;subtext&gt;"RPM"&lt;/subtext&gt;
      &lt;size&gt;200&lt;/size&gt;
      &lt;min_&gt;0&lt;/min_&gt;
      &lt;max_&gt;3000&lt;/max_&gt;
      &lt;majorscale&gt;500&lt;/majorscale&gt;
      &lt;minorscale&gt;100&lt;/minorscale&gt;
      &lt;region1&gt;0,10,"yellow"&lt;/region1&gt;
    &lt;/meter&gt;
  &lt;/hbox&gt;

  &lt;!-- the On Led --&gt;
  &lt;hbox&gt;
  &lt;relief&gt;RAISED&lt;/relief&gt;
  &lt;bd&gt;3&lt;/bd&gt;
  &lt;vbox&gt;
  &lt;relief&gt;RAISED&lt;/relief&gt;
  &lt;bd&gt;2&lt;/bd&gt;
  &lt;label&gt;
  &lt;text&gt;"On"&lt;/text&gt;
  &lt;font&gt;("Helvetica",18)&lt;/font&gt;
  &lt;/label&gt;
  &lt;width&gt;5&lt;/width&gt;
   &lt;hbox&gt;
  &lt;label width="2"/&gt; &lt;!-- used to center the led --&gt;
  &lt;rectled&gt;
  &lt;halpin&gt;"on-led"&lt;/halpin&gt;
  &lt;height&gt;"30"&lt;/height&gt;
  &lt;width&gt;"30"&lt;/width&gt;
  &lt;on_color&gt;"green"&lt;/on_color&gt;
  &lt;off_color&gt;"red"&lt;/off_color&gt;
  &lt;/rectled&gt;
  &lt;/hbox&gt;
  &lt;/vbox&gt;

  &lt;!-- the FWD Led --&gt;
  &lt;vbox&gt;
    &lt;relief&gt;RAISED&lt;/relief&gt;
    &lt;bd&gt;2&lt;/bd&gt;
    &lt;label&gt;
      &lt;text&gt;"FWD"&lt;/text&gt;
      &lt;font&gt;("Helvetica",18)&lt;/font&gt;
      &lt;width&gt;5&lt;/width&gt;
    &lt;/label&gt;
   &lt;label width="2"/&gt;
    &lt;rectled&gt;
      &lt;halpin&gt;"fwd-led"&lt;/halpin&gt;
      &lt;height&gt;"30"&lt;/height&gt;
      &lt;width&gt;"30"&lt;/width&gt;
      &lt;on_color&gt;"green"&lt;/on_color&gt;
      &lt;off_color&gt;"red"&lt;/off_color&gt;
    &lt;/rectled&gt;
  &lt;/vbox&gt;

  &lt;!-- the REV Led --&gt;
  &lt;vbox&gt;
  &lt;relief&gt;RAISED&lt;/relief&gt;
  &lt;bd&gt;2&lt;/bd&gt;
    &lt;label&gt;
      &lt;text&gt;"REV"&lt;/text&gt;
      &lt;font&gt;("Helvetica",18)&lt;/font&gt;
       &lt;width&gt;5&lt;/width&gt;
    &lt;/label&gt;
    &lt;label width="2"/&gt;
    &lt;rectled&gt;
      &lt;halpin&gt;"rev-led"&lt;/halpin&gt;
      &lt;height&gt;"30"&lt;/height&gt;
      &lt;width&gt;"30"&lt;/width&gt;
      &lt;on_color&gt;"red"&lt;/on_color&gt;
      &lt;off_color&gt;"green"&lt;/off_color&gt;
    &lt;/rectled&gt;
  &lt;/vbox&gt;
  &lt;/hbox&gt;
&lt;/pyvcp&gt;</code></pre>
</div></div>
<div class="paragraph"><p>The above gives us a PyVCP panel that looks like the following.</p></div>
<div class="imageblock">
<div class="content">
<figure>
<img src="images/gs2_panel.png" alt="GS2 Panel"/>
</figure>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_connections">5.2. The Connections</h3>
<div class="paragraph"><p>To make it work we add the following code to the custom_postgui.hal
file.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># display the rpm based on freq * rpm per hz</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">loadrt</span></span> <span style="font-weight: bold"><span style="color: #000000">mult2</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">addf</span></span> <span style="color: #009900">mult2.0</span> <span style="font-weight: bold"><span style="color: #000000">servo-thread</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">setp</span></span> <span style="color: #009900">mult2.0.in1</span> <span style="color: #993399">28.75</span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">cypher_speed</span></span> <span style="color: #009900">mult2.0.in0</span> <span style="color: #990000">&lt;=</span> <span style="font-weight: bold"><span style="color: #000000">spindle-vfd</span></span>.<span style="font-weight: bold"><span style="color: #000000">frequency-out</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">speed_out</span></span> <span style="color: #009900">pyvcp.spindle_rpm</span> <span style="color: #990000">&lt;=</span> <span style="color: #009900">mult2.0.out</span>

<span style="font-style: italic"><span style="color: #9A1900"># run led</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">gs2-run</span></span> <span style="color: #990000">=&gt;</span> <span style="color: #009900">pyvcp.on-led</span>

<span style="font-style: italic"><span style="color: #9A1900"># fwd led</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">gs2-fwd</span></span> <span style="color: #990000">=&gt;</span> <span style="color: #009900">pyvcp.fwd-led</span>

<span style="font-style: italic"><span style="color: #9A1900"># rev led</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">running-rev</span></span> <span style="font-weight: bold"><span style="color: #000000">spindle-vfd</span></span>.<span style="font-weight: bold"><span style="color: #000000">spindle-rev</span></span> <span style="color: #990000">=&gt;</span> <span style="color: #009900">pyvcp.rev-led</span></tt></pre></div></div>
<div class="paragraph"><p>Some of the lines might need some explanations. The fwd led line uses
the signal created in the custom.hal file whereas the rev led needs to
use the spindle-rev bit. You can&#8217;t link the spindle-fwd bit twice so
you use the signal that it was linked to.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rapid_to_home_button">6. Rapid to Home Button</h2>
<div class="sectionbody">
<div class="paragraph"><p>This example creates a button on the PyVCP side panel when pressed will send
all the axis back to the home position. This example assumes you don&#8217;t have a
PyVCP panel.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<figure>
<img src="images/pyvcp-rth.png" alt="images/pyvcp-rth.png"/>
</figure>
</div>
</div>
<div class="paragraph"><p>In your configuration directory create the XML file. In this example it&#8217;s named
<em>rth.xml</em>. In the <em>rth.xml</em> file add the following code to create the button.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>&lt;pyvcp&gt;
&lt;!-- rapid to home button example --&gt;
&lt;button&gt;
&lt;halpin&gt;"rth-button"&lt;/halpin&gt;
&lt;text&gt;"Rapid to Home"&lt;/text&gt;
&lt;/button&gt;
&lt;/pyvcp&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Open your INI file with a text editor and in the [DISPLAY] section add the
following line. This is what loads the PyVCP panel.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">PYVCP </span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900"> rth.xml</span></tt></pre></div></div>
<div class="paragraph"><p>If you don&#8217;t have a [HALUI] section in the INI file create it and add the
following MDI command.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">MDI_COMMAND </span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900"> G53 G0 X0 Y0 Z0</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>Information about <a href="../gcode/g-code.html#gcode:g53">G53</a> and <a href="../gcode/g-code.html#gcode:g0">G0</a> G-codes.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>In the [HAL] section if you don&#8217;t have a post gui file add the following and
create a file called <em>postgui.hal</em>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">POSTGUI_HALFILE </span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900"> postgui.hal</span></tt></pre></div></div>
<div class="paragraph"><p>In the <em>postgui.hal</em> file add the following code to link the PyVCP button to the
MDI command.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">rth</span></span> <span style="color: #009900">halui.mdi-command-00</span> <span style="color: #990000">&lt;=</span> <span style="color: #009900">pyvcp.rth-button</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>Information about the <a href="../hal/basic-hal.html#sub:hal-net">net</a> command</p></div>
</td>
</tr></table>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2023-02-15 15:12:15 CET
</div>
</div>
</body>
</html>
